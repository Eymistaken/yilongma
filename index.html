<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skibidi Clicker: Rivalry</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js (Sesler i√ßin) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <!-- Chart.js (Grafikler i√ßin) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        glass: "rgba(20, 20, 25, 0.7)",
                        glassBorder: "rgba(255, 255, 255, 0.08)",
                        accent: "#8b5cf6"
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'gradient-xy': 'gradient-xy 15s ease infinite',
                        'spin-slow': 'spin 3s linear infinite',
                        'bounce-short': 'bounce-short 0.5s ease-in-out',
                        'flash-green': 'flash-green 2s ease-out infinite',
                        'glow-pulse': 'glow-pulse 1.5s ease-in-out infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'gradient-xy': {
                            '0%, 100%': {
                                'background-size': '400% 400%',
                                'background-position': '0% 50%'
                            },
                            '50%': {
                                'background-size': '400% 400%',
                                'background-position': '100% 50%'
                            }
                        },
                        'bounce-short': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20%)' }
                        },
                        'flash-green': {
                            '0%, 100%': { boxShadow: '0 0 0 rgba(74, 222, 128, 0)' },
                            '50%': { boxShadow: '0 0 20px rgba(74, 222, 128, 0.6)', borderColor: '#4ade80' }
                        },
                        'glow-pulse': {
                            '0%, 100%': { filter: 'drop-shadow(0 0 2px rgba(250, 204, 21, 0.5))' },
                            '50%': { filter: 'drop-shadow(0 0 10px rgba(250, 204, 21, 1))' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #1a1a2e);
            background-size: 400% 400%;
            animation: gradient-xy 15s ease infinite;
            color: #e2e8f0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* √ñzel Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: #4c1d95;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6d28d9;
        }

        /* Glassmorphism Ortak Sƒ±nƒ±fƒ± */
        .glass-panel {
            background: rgba(15, 15, 20, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.4);
        }

        /* Skibidi Buton Animasyonlarƒ± */
        #skibidi-toilet {
            font-size: 140px;
            cursor: pointer;
            transition: transform 0.08s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.4));
            position: relative;
            z-index: 10;
        }

        #skibidi-toilet:active {
            transform: scale(0.85) rotate(-5deg);
            filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.8));
        }

        #skibidi-toilet:hover {
            filter: drop-shadow(0 0 30px rgba(139, 92, 246, 0.7));
            transform: scale(1.05);
        }

        /* Par√ßacƒ±k ve Popup Efektleri */
        .click-popup {
            position: absolute;
            font-weight: 900;
            pointer-events: none;
            animation: popup-anim 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            z-index: 20;
            white-space: nowrap;
        }

        @keyframes popup-anim {
            0% {
                transform: translateY(0) scale(0.5) rotate(var(--rot));
                opacity: 0;
            }

            20% {
                transform: translateY(-30px) scale(1.3) rotate(var(--rot));
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                transform: translateY(-120px) scale(0.8) rotate(var(--rot));
                opacity: 0;
            }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            background: white;
            border-radius: 50%;
            animation: particle-anim 0.8s cubic-bezier(0, 0.9, 0.57, 1) forwards;
            box-shadow: 0 0 10px currentColor;
        }

        @keyframes particle-anim {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }

            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        /* Arka Plan Y√ºzen Objeler */
        .floater {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            opacity: 0.05;
            z-index: 0;
            animation: float-up linear forwards;
            filter: blur(2px);
        }

        @keyframes float-up {
            from {
                transform: translateY(110vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.1;
            }

            90% {
                opacity: 0.1;
            }

            to {
                transform: translateY(-10vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Skitter Feed Stilleri */
        details#skitter-feed {
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        details#skitter-feed[open] {
            width: 340px;
            max-height: 500px;
        }

        details#skitter-feed:not([open]) {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            overflow: hidden;
        }

        details#skitter-feed summary {
            list-style: none;
            cursor: pointer;
        }

        details#skitter-feed summary::-webkit-details-marker {
            display: none;
        }

        /* Y√ºkseltme Butonlarƒ± */
        .upgrade-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .upgrade-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }

        .upgrade-btn:hover::after {
            transform: translateX(100%);
        }

        .upgrade-btn:active {
            transform: scale(0.96);
        }

        .upgrade-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(0.8);
        }

        /* Sortable Ghost */
        .sortable-ghost {
            opacity: 0.2;
            background: #6366f1;
        }

        /* Slot Makinesi */
        .slot-reel {
            background: #1e1b4b;
            border-radius: 0.5rem;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
        }

        .reel-inner {
            transition: transform 0.1s ease-out;
            will-change: transform;
        }

        .slot-symbol {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .jackpot-anim {
            animation: jackpot 0.5s ease-in-out infinite alternate;
        }

        @keyframes jackpot {
            from {
                text-shadow: 0 0 10px #fbbf24;
                transform: scale(1);
            }

            to {
                text-shadow: 0 0 30px #f59e0b, 0 0 10px white;
                transform: scale(1.1);
            }
        }

        /* Yilong Ma Wealth Box */
        .yilong-box {
            background: linear-gradient(90deg, #1e293b, #0f172a);
            border: 1px solid #334155;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .progress-bar {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Yeni Efekt Sƒ±nƒ±flarƒ± */
        .highlight-asset {
            animation: flash-green 2s ease-out infinite;
            border-color: #4ade80 !important;
        }

        .new-skitt-glow {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.3);
            animation: glow-pulse 1.5s ease-in-out infinite alternate;
        }

        /* PHASE 3 EFFECTS */
        .crt-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 99999;
            opacity: 0.7;
        }

        .glitch-text {
            text-shadow: 2px 2px #ff0000, -2px -2px #0000ff;
            animation: glitch-anim 0.3s infinite;
        }

        @keyframes glitch-anim {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center py-4 relative text-slate-200">

    <!-- BSOD LAYER -->
    <div id="bsod-layer" class="fixed inset-0 z-[9999] bg-[#0000aa] hidden cursor-none font-mono text-white p-10 flex-col overflow-hidden">
        <div class="max-w-4xl mx-auto space-y-4">
            <p class="text-xl">A problem has been detected and Windows has been shut down to prevent damage to your computer.</p>
            <p class="text-xl mt-8">CRITICAL_PROCESS_DIED</p>
            <p class="mt-8">If this is the first time you've seen this Stop error screen, restart your computer. If this screen appears again, follow these steps:</p>
            <p>Check to make sure any new hardware or software is properly installed. If this is a new installation, ask your hardware or software manufacturer for any Windows updates you might need.</p>
            <p>If problems continue, disable or remove any newly installed hardware or software. Disable BIOS memory options such as caching or shadowing. If you need to use Safe Mode to remove or disable components, restart your computer, press F8 to select Advanced Startup Options, and then select Safe Mode.</p>
            <p class="mt-8">Technical Information:</p>
            <p>*** STOP: 0x000000YILONG (0xFFFFFFFF, 0x00000000, 0x00000000, 0x00000000)</p>
            <p class="mt-8">Collecting data for crash dump ... <span id="bsod-percent">0</span>%</p>
            <p>Initializing disk for crash dump ...</p>
        </div>
    </div>

    <!-- BLACKOUT LAYER -->
    <div id="blackout-layer" class="fixed inset-0 z-[9998] bg-black hidden"></div>

    <!-- GAME WORLD WRAPPER -->
    <div id="game-world" class="contents">

    <!-- Arka Plan Efektleri -->
    <div id="floater-container" class="fixed inset-0 pointer-events-none overflow-hidden z-0"></div>

    <!-- YILONG MA SERVET KUTUSU -->
    <div
        class="fixed top-4 right-4 z-40 yilong-box rounded-2xl p-3 flex flex-col gap-1 w-64 animate-float border-l-4 border-yellow-500">
        <div class="flex items-center gap-3 mb-1">
            <div
                class="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center border border-yellow-500/30 overflow-hidden">
                <span class="text-2xl" id="yilong-avatar">ü§ì</span>
            </div>
            <div>
                <h3 class="text-xs font-bold text-slate-400 uppercase">Yilong Ma</h3>
                <div id="realtime-yilong-wealth" class="text-lg font-mono font-black text-yellow-400 leading-none">5.00M
                </div>
            </div>
        </div>

        <!-- Hedef Progress Bar -->
        <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden mt-1 relative">
            <div id="wealth-progress" class="h-full bg-gradient-to-r from-violet-600 to-fuchsia-400 w-0 relative">
                <div class="absolute right-0 top-0 bottom-0 w-1 bg-white/50 animate-pulse"></div>
            </div>
        </div>
        <div class="flex justify-between text-[9px] text-slate-500 font-mono mt-0.5">
            <span>Senin Paran</span>
            <span class="text-violet-300">Hedef: <span id="dynamic-target">10M</span></span>
        </div>
    </div>

    <!-- Skitter (Twitter) Widget - SOL √úST -->
    <details id="skitter-feed" class="fixed top-4 left-4 z-40 glass-panel rounded-2xl border-opacity-20 border-white">
        <summary class="flex items-center justify-center w-full h-full p-0 m-0 focus:outline-none relative">
            <div class="absolute inset-0 flex items-center justify-center transition-opacity duration-300 bg-sky-600 hover:bg-sky-500 text-white rounded-full"
                id="skitter-icon">
                <span class="text-2xl">üê¶</span>
            </div>
            <div class="w-full px-4 py-3 flex justify-between items-center opacity-0 hidden"
                id="skitter-expanded-header">
                <span class="font-bold text-sky-400 flex items-center gap-2">Skitter <span
                        class="text-[10px] bg-red-500/20 px-2 py-0.5 rounded border border-red-500/40 text-red-400 animate-pulse">LIVE</span></span>
                <div class="text-right">
                    <span class="text-[10px] text-slate-400 uppercase tracking-wider block">Yilong'u Ge√ß</span>
                    <span id="yilong-ma-servet-display" class="font-mono text-xs text-yellow-400 font-bold">5.00M</span>
                </div>
            </div>
        </summary>
        <div class="px-4 pb-4 pt-0 max-h-[400px] overflow-y-auto flex flex-col gap-3 mt-2 scrollbar-hide"
            id="skitter-messages">
            <!-- Mesajlar -->
        </div>
    </details>

    <!-- TEMP DEV BUTTON -->
    <button id="dev-cheat-btn" class="fixed top-4 left-24 z-50 bg-red-600/50 hover:bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded border border-white/20 backdrop-blur-sm transition-all">
        DEV: 1.99x
    </button>

    <!-- Ana Konteyner -->
    <div
        class="container mx-auto px-4 max-w-7xl relative z-10 flex flex-col lg:flex-row gap-6 h-full items-start mt-16 md:mt-4">

        <!-- SOL PANEL: Slot Makinesi & Mini Oyunlar -->
        <div class="hidden lg:flex flex-col gap-4 w-1/4 sticky top-4">
            <div class="glass-panel p-5 rounded-3xl border-t-4 border-yellow-500 relative overflow-hidden group">
                <!-- Parlama Efekti -->
                <div
                    class="absolute inset-0 bg-yellow-500/5 group-hover:bg-yellow-500/10 transition-colors duration-500">
                </div>

                <h2 class="text-xl font-black italic mb-4 text-yellow-400 flex items-center gap-2 relative z-10">
                    üé∞ SKIBIDI SLOTS
                </h2>

                <!-- Slot Ekranƒ± -->
                <div
                    class="grid grid-cols-3 gap-2 mb-4 bg-black/40 p-2 rounded-xl border border-white/10 relative z-10">
                    <div class="slot-reel h-20" id="reel-1">
                        <div class="reel-inner" id="reel-inner-1">
                            <div class="slot-symbol">üçí</div>
                        </div>
                    </div>
                    <div class="slot-reel h-20" id="reel-2">
                        <div class="reel-inner" id="reel-inner-2">
                            <div class="slot-symbol">üçí</div>
                        </div>
                    </div>
                    <div class="slot-reel h-20" id="reel-3">
                        <div class="reel-inner" id="reel-inner-3">
                            <div class="slot-symbol">üçí</div>
                        </div>
                    </div>
                </div>

                <!-- Bilgi Notu (S√úRPRƒ∞Z) -->

                <div class="flex justify-between items-center mb-2 relative z-10">
                    <div id="slot-cost-container" class="text-xs text-slate-400">
                        Bedel: <span class="text-violet-400 font-bold" id="slot-cost">500</span> Gyatt
                    </div>
                    <!-- Phase 2 Bet Input (Initially Hidden) -->
                    <div id="slot-bet-input-container" class="hidden flex items-center gap-2">
                        <span class="text-[10px] text-slate-400">BET:</span>
                        <input type="number" id="slot-bet-input" value="1000" min="100" class="w-20 bg-black/50 border border-white/20 rounded px-2 py-1 text-xs text-right font-mono text-yellow-400 focus:outline-none focus:border-yellow-500">
                    </div>

                    <span class="text-xs text-yellow-400 font-bold" id="slot-status">≈ûansƒ±nƒ± Dene!</span>
                </div>

                <div class="flex gap-2 relative z-10">
                    <button id="spin-btn"
                        class="flex-1 bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white font-bold py-3 rounded-xl shadow-lg transform active:scale-95 transition-all border border-yellow-400/30">
                        √áEVƒ∞R!
                    </button>
                    <button id="spin-all-in-btn"
                        class="hidden flex-1 bg-gradient-to-r from-red-600 to-purple-600 hover:from-red-500 hover:to-purple-500 text-white font-bold py-3 rounded-xl shadow-lg transform active:scale-95 transition-all border border-purple-400/30">
                        ALL IN!
                    </button>
                </div>
            </div>

            <!-- Ekstra ƒ∞statistikler -->
            <div class="glass-panel p-5 rounded-3xl">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-3">ƒ∞statistikler</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-slate-500">Toplam Tƒ±k</span>
                        <span class="font-mono" id="stat-clicks">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">Slot Kazancƒ±</span>
                        <span class="font-mono text-emerald-400" id="stat-slot-win">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">Oyun S√ºresi</span>
                        <span class="font-mono" id="stat-time">00:00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ORTA PANEL: Ana Oyun -->
        <div class="w-full lg:w-2/4 flex flex-col items-center gap-6">

            <!-- Ba≈ülƒ±k -->
            <div class="text-center space-y-1 animate-float z-20">
                <h1
                    class="text-4xl md:text-6xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-violet-400 via-fuchsia-400 to-white drop-shadow-[0_0_25px_rgba(139,92,246,0.6)]">
                    SKIBIDI CLICKER
                </h1>
                <p class="text-slate-400 font-medium tracking-[0.3em] text-[10px] uppercase">Rivalry Edition: Beat
                    Yilong</p>
            </div>

            <!-- Skor Kartlarƒ± - Updated Grid to 2 cols (removed CPS) -->
            <div class="grid grid-cols-2 gap-3 w-full">
                <div class="glass-panel p-3 md:p-4 rounded-2xl flex flex-col items-center text-center">
                    <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase">Gyatt Points</span>
                    <div class="text-2xl md:text-4xl font-black text-violet-400 break-all leading-tight mt-1"
                        id="score">0</div>
                </div>
                <div class="glass-panel p-3 md:p-4 rounded-2xl flex flex-col items-center text-center">
                    <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase">Senin Servetin</span>
                    <div class="text-xl md:text-3xl font-bold text-emerald-400 mt-1" id="total-wealth">0</div>
                </div>
            </div>

            <!-- Tƒ±klama Alanƒ± -->
            <div class="relative flex justify-center items-center py-6 md:py-12 w-full select-none">
                <div id="popup-container" class="absolute inset-0 pointer-events-none overflow-visible"></div>

                <div class="relative group cursor-pointer">
                    <!-- Glow -->
                    <div
                        class="absolute inset-0 bg-violet-600 blur-[80px] opacity-20 group-hover:opacity-50 transition-opacity duration-500 rounded-full animate-pulse-slow">
                    </div>
                    <div id="skibidi-toilet" class="relative">üöΩ</div>
                </div>
            </div>

            <!-- Mobil ƒ∞√ßin Slot Butonu (Sadece mobilde g√∂r√ºn√ºr) -->
            <div class="lg:hidden w-full">
                <button onclick="toggleMobileSlot()"
                    class="w-full bg-yellow-600/20 border border-yellow-500/50 text-yellow-400 font-bold py-3 rounded-xl">
                    üé∞ Mini Game: Slots Oyna
                </button>
            </div>

            <!-- Piyasalar (Market) -->
            <div class="w-full glass-panel rounded-2xl p-4 md:p-6 border-t-4 border-emerald-500 flex-grow">
                <h2 class="text-lg font-bold mb-4 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="bg-emerald-500/20 p-1.5 rounded-lg text-emerald-300">üìà</span>
                        <span>Borsa (Stock Market)</span>
                    </div>
                    <span class="text-[10px] text-slate-500 font-normal hidden md:block">Drag & Drop Aktif</span>
                </h2>
                <div id="market-list-container" class="space-y-3 pb-20">
                    <!-- Marketler buraya -->
                </div>
            </div>

        </div>

        <!-- SAƒû PANEL: Y√ºkseltmeler -->
        <div id="right-panel" class="w-full lg:w-1/4 flex flex-col gap-4 sticky top-4 h-fit">
            <div class="glass-panel rounded-3xl p-5 border-t-4 border-violet-500">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <span class="bg-violet-500/20 p-2 rounded-lg text-violet-300">‚ö°</span>
                    Y√ºkseltmeler
                </h2>

                <div class="space-y-3" id="upgrades-list">
                    <!-- Rizz Upgrade -->
                    <button id="upgrade-ppc"
                        class="upgrade-btn w-full bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl p-3 flex flex-col gap-1 text-left group">
                        <div class="flex justify-between items-start w-full">
                            <div>
                                <span class="font-bold text-slate-200 group-hover:text-white block">More Rizz</span>
                                <span class="text-[10px] text-slate-400">+1 Tƒ±k G√ºc√º</span>
                            </div>
                            <div class="text-right">
                                <span
                                    class="bg-violet-500/20 text-violet-300 text-[10px] px-1.5 py-0.5 rounded font-mono block mb-1">LVL
                                    <span id="lvl-ppc">1</span></span>
                            </div>
                        </div>
                        <div class="mt-1 pt-2 border-t border-white/5 flex justify-between items-center w-full">
                            <span class="text-[10px] text-slate-500 uppercase">Bedel</span>
                            <span id="cost-ppc" class="text-violet-400 font-bold font-mono text-sm">15</span>
                        </div>
                    </button>

                    <!-- Auto Clicker REMOVED -->

                    <!-- Multiplier -->
                    <button id="upgrade-multi"
                        class="upgrade-btn w-full bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl p-3 flex flex-col gap-1 text-left group">
                        <div class="flex justify-between items-start w-full">
                            <div>
                                <span class="font-bold text-slate-200 group-hover:text-white block">Sigma
                                    Grindset</span>
                                <span class="text-[10px] text-slate-400">T√ºm Gelir x1.5</span>
                            </div>
                            <div class="text-right">
                                <span
                                    class="bg-pink-500/20 text-pink-300 text-[10px] px-1.5 py-0.5 rounded font-mono block mb-1">LVL
                                    <span id="lvl-multi">0</span></span>
                            </div>
                        </div>
                        <div class="mt-1 pt-2 border-t border-white/5 flex justify-between items-center w-full">
                            <span class="text-[10px] text-slate-500 uppercase">Bedel</span>
                            <span id="cost-multi" class="text-pink-400 font-bold font-mono text-sm">2,500</span>
                        </div>
                    </button>

                    <!-- Fanum Tax -->
                    <button id="upgrade-tax"
                        class="upgrade-btn w-full bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl p-3 flex flex-col gap-1 text-left group">
                        <div class="flex justify-between items-start w-full">
                            <div>
                                <span class="font-bold text-slate-200 group-hover:text-white block">Fanum Tax</span>
                                <span class="text-[10px] text-slate-400">Piyasa Pasif Gelir %</span>
                            </div>
                            <div class="text-right">
                                <span
                                    class="bg-emerald-500/20 text-emerald-300 text-[10px] px-1.5 py-0.5 rounded font-mono block mb-1">LVL
                                    <span id="lvl-tax">0</span></span>
                            </div>
                        </div>
                        <div class="mt-1 pt-2 border-t border-white/5 flex justify-between items-center w-full">
                            <span class="text-[10px] text-slate-500 uppercase">Bedel</span>
                            <span id="cost-tax" class="text-emerald-400 font-bold font-mono text-sm">10,000</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>

    </div>

    </div> <!-- END GAME WORLD WRAPPER -->

    <!-- Mesaj Modal -->
    <div id="message-box"
        class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 opacity-0 pointer-events-none transition-opacity duration-300 px-4">
        <div class="glass-panel p-8 rounded-3xl max-w-md w-full text-center transform scale-90 transition-transform duration-300 border-2 border-violet-500/30 shadow-[0_0_50px_rgba(139,92,246,0.3)]"
            id="message-content-box">
            <div class="mb-6" id="message-text"></div>
            <button id="message-close"
                class="w-full bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-violet-500/30 transition-all transform hover:-translate-y-1 hover:shadow-violet-500/50 active:translate-y-0">
                DEVAM ET üî•
            </button>
        </div>
    </div>

    <!-- Mobile Slot Modal -->
    <div id="mobile-slot-modal"
        class="fixed inset-0 z-50 bg-black/90 hidden flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-sm glass-panel p-6 rounded-2xl relative">
            <button onclick="toggleMobileSlot()"
                class="absolute top-2 right-2 text-white/50 hover:text-white text-2xl">&times;</button>
            <h2 class="text-2xl font-black text-center text-yellow-400 mb-6">üé∞ MOBILE SLOTS</h2>

            <div class="grid grid-cols-3 gap-2 mb-6 bg-black/40 p-2 rounded-xl border border-white/10">
                <div class="slot-reel h-20" id="m-reel-1">
                    <div class="reel-inner" id="m-reel-inner-1">
                        <div class="slot-symbol">üçí</div>
                    </div>
                </div>
                <div class="slot-reel h-20" id="m-reel-2">
                    <div class="reel-inner" id="m-reel-inner-2">
                        <div class="slot-symbol">üçí</div>
                    </div>
                </div>
                <div class="slot-reel h-20" id="m-reel-3">
                    <div class="reel-inner" id="m-reel-inner-3">
                        <div class="slot-symbol">üçí</div>
                    </div>
                </div>
            </div>

            <div class="text-center mb-4">
                <p class="text-sm text-slate-400">Bedel: <span class="text-violet-400 font-bold"
                        id="m-slot-cost">500</span></p>
                <p class="text-lg font-bold text-yellow-500" id="m-slot-status">≈ûansƒ±nƒ± Dene!</p>
            </div>

            <div class="flex gap-2 w-full">
                <button id="m-spin-btn"
                    class="flex-1 bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-4 rounded-xl">√áEVƒ∞R!</button>
                <button id="m-spin-all-in-btn"
                    class="hidden flex-1 bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl">ALL IN!</button>
            </div>
        </div>
    </div>

    <!-- Gacha Modal -->
    <div id="gacha-modal" class="fixed inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 backdrop-blur-md">
        <h2 class="text-3xl md:text-5xl font-black text-red-500 mb-8 animate-pulse tracking-widest uppercase">Gƒ∞ZLƒ∞ KASA</h2>
        <p class="text-slate-400 mb-8 animate-bounce">Bir kart se√ß...</p>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8 w-full max-w-5xl px-4" id="gacha-cards">
            <!-- Cards injected by JS -->
        </div>
    </div>

    <!-- VERSION BADGE -->
    <div class="fixed bottom-2 left-2 z-50 text-[10px] font-mono text-slate-500 opacity-50 pointer-events-none">
        V3.1
    </div>

    <!-- PHASE 3 MULTIVERSE MODAL -->
    <div id="p3-multiverse-modal" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-1000">
        <h1 class="text-4xl md:text-6xl font-black text-white mb-2 glitch-text tracking-widest">SYSTEM REBOOT</h1>
        <p class="text-slate-400 mb-10 font-mono">Select timeline initialization...</p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl w-full px-4">
            <!-- RED ROT -->
            <button onclick="initPhase3('red_rot')" class="group relative bg-black border-2 border-red-900 hover:border-red-500 p-6 rounded-xl flex flex-col items-center gap-4 transition-all hover:scale-105 overflow-hidden">
                <div class="absolute inset-0 bg-red-900/10 group-hover:bg-red-900/30 animate-pulse"></div>
                <div class="text-5xl">ü©∏</div>
                <h3 class="text-2xl font-black text-red-500">THE RED ROT</h3>
                <p class="text-xs text-red-300 text-center font-mono">
                    HYPER-INFLATION DETECTED.<br>
                    Prices double every 30s.<br>
                    Cash rots 1%/sec.
                </p>
                <div class="bg-red-900/50 px-3 py-1 rounded text-xs text-white">HARDCORE SURVIVAL</div>
            </button>

            <!-- THE MATRIX -->
            <button onclick="initPhase3('matrix')" class="group relative bg-black border-2 border-green-900 hover:border-green-500 p-6 rounded-xl flex flex-col items-center gap-4 transition-all hover:scale-105 overflow-hidden">
                <div class="absolute inset-0 bg-green-900/10 group-hover:bg-green-900/30 animate-pulse"></div>
                <div class="text-5xl">üìü</div>
                <h3 class="text-2xl font-black text-green-500 font-mono">THE MATRIX</h3>
                <p class="text-xs text-green-300 text-center font-mono">
                    CRYPTO ANARCHY.<br>
                    Fiat Banned. Crypto Volatility 500%.<br>
                    Mouse Hacked (No Clicking).
                </p>
                <div class="bg-green-900/50 px-3 py-1 rounded text-xs text-white">PASSIVE ONLY</div>
            </button>

            <!-- THE VOID -->
            <button onclick="initPhase3('void')" class="group relative bg-black border-2 border-slate-700 hover:border-white p-6 rounded-xl flex flex-col items-center gap-4 transition-all hover:scale-105 overflow-hidden">
                <div class="absolute inset-0 bg-white/5 group-hover:bg-white/10 animate-pulse"></div>
                <div class="text-5xl opacity-50">üëª</div>
                <h3 class="text-2xl font-black text-slate-300 blur-[1px] group-hover:blur-0 transition-all">THE VOID</h3>
                <p class="text-xs text-slate-400 text-center font-mono">
                    ENTROPY RISING.<br>
                    Assets are deleted randomly.<br>
                    Pay Data to restore.
                </p>
                <div class="bg-slate-800 px-3 py-1 rounded text-xs text-white">CHAOS MODE</div>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- OYUN DEƒûƒ∞≈ûKENLERƒ∞ ---
            let YilongBaseWealth = 5000000; // Yilong Ma'nƒ±n NAKƒ∞T serveti (Dinamik artƒ±yor)
            let hasWonGame = false;

            // Phase 2 Gacha Items (Black Market)
            const blackMarketItems = [
                { id: 'bm_gold_toilet', name: 'Golden Toilet', mult: 2.0, rarity: 'LEGENDARY', color: '#fbbf24' },
                { id: 'bm_diamond_flush', name: 'Diamond Flush', mult: 1.5, rarity: 'EPIC', color: '#38bdf8' },
                { id: 'bm_skibidi_crown', name: 'Skibidi Crown', mult: 1.25, rarity: 'RARE', color: '#c084fc' },
                { id: 'bm_fanum_shield', name: 'Fanum Shield', mult: 1.1, rarity: 'COMMON', color: '#94a3b8' },
                { id: 'bm_cyber_attack', name: 'Cyber Attack', type: 'sabotage', val: 0.10, rarity: 'EPIC', color: '#ef4444' },
                { id: 'bm_market_crash', name: 'Market Crash', type: 'sabotage', val: 0.25, rarity: 'LEGENDARY', color: '#b91c1c' }
            ];

            // Global eri≈üim i√ßin window'a ata
            window.gameState = {
                phase: 1, // Phase 1 or 2
                score: 0,
                totalWealth: 0,
                clicks: 0,
                clickPower: 1,
                multiplier: 1,
                marketPassiveRate: 0,
                gameStartTime: Date.now(),
                slotWins: 0,

                // Black Market
                blackMarketCost: 100000,
                blackMarketBuffs: [], // Array of collected item IDs

                // Mechanics
                clickDebuff: 1, // 1 = Normal, 0.5 = Canceled

                // PHASE 3 VARS
                p3_universe: null,
                p3_firewallHealth: 100,
                p3_entropyTimer: 0,
                p3_exploitCost: 1000000000000,

                // Y√ºkseltme Seviyeleri
                lvlPpc: 1,
                lvlMulti: 0,
                lvlTax: 0,

                // Y√ºkseltme Maliyetleri
                costPpc: 15,
                costMulti: 2500,
                costTax: 10000
            };

            // Kolay eri≈üim i√ßin yerel deƒüi≈üken referansƒ±
            let gameState = window.gameState;

            // --- PHASE 3 LOGIC ---
            const triggerPhase3 = () => {
                gameState.phase = 3;

                // Hide Game UI
                document.getElementById('game-world').classList.add('hidden');
                document.getElementById('message-box').style.opacity = 0;
                document.getElementById('message-box').style.pointerEvents = 'none';

                // Show BSOD
                const bsod = document.getElementById('bsod-layer');
                bsod.classList.remove('hidden');
                bsod.classList.add('flex');

                // Audio Cut & Phase 3 Setup
                if(synth) {
                    synth.triggerRelease();
                    synth.volume.value = -12; // Lower volume
                    // Add BitCrusher (Distortion)
                    const crusher = new Tone.BitCrusher(4).toDestination();
                    synth.disconnect();
                    synth.connect(crusher);
                }

                // BSOD Counter
                let percent = 0;
                const interval = setInterval(() => {
                    percent += Math.floor(Math.random() * 5);
                    if(percent > 100) percent = 100;
                    document.getElementById('bsod-percent').textContent = percent;
                }, 500);

                // 10s -> Blackout
                setTimeout(() => {
                    clearInterval(interval);
                    bsod.classList.add('hidden');
                    bsod.classList.remove('flex');
                    document.getElementById('blackout-layer').classList.remove('hidden');

                    // 3s -> Reboot
                    setTimeout(() => {
                        // RESET FOR PHASE 3
                        gameState.score = 1000;
                        gameState.clicks = 0;
                        for(let k in assets) {
                            assets[k].count = 0;
                            assets[k].price = assets[k].history[0];
                        }
                        gameState.lvlPpc = 1; gameState.costPpc = 15;
                        gameState.lvlMulti = 0; gameState.costMulti = 2500;
                        gameState.lvlTax = 0; gameState.costTax = 10000;
                        gameState.clickPower = 1;
                        gameState.multiplier = 1;
                        gameState.marketPassiveRate = 0;
                        recalculateMultipliers();

                        document.getElementById('blackout-layer').classList.add('hidden');

                        // Glitch Effect
                        const overlay = document.createElement('div');
                        overlay.className = 'crt-overlay';
                        document.body.appendChild(overlay);

                        document.body.style.background = "#000";
                        document.body.style.filter = "brightness(0.3) sepia(1) hue-rotate(180deg) contrast(1.2)";
                        document.body.style.transition = "filter 2s";

                        // Fade in Multiverse (Blink)
                        const mvModal = document.getElementById('p3-multiverse-modal');
                        mvModal.className += " blink-fade-in";
                        mvModal.style.opacity = 1;
                        mvModal.style.pointerEvents = 'auto';

                        if(synth) synth.triggerAttackRelease("C1", "4n"); // Reboot sound

                    }, 3000);
                }, 10000);
            };

            window.initPhase3 = (universe) => {
                gameState.p3_universe = universe;

                // Hide Modal
                document.getElementById('p3-multiverse-modal').style.opacity = 0;
                document.getElementById('p3-multiverse-modal').style.pointerEvents = 'none';

                // Show Game World
                document.getElementById('game-world').classList.remove('hidden');

                // Apply Universe Specifics
                if (universe === 'matrix') {
                    // Delete Fiat
                    delete assets['tl'];
                    delete assets['usd'];
                    delete assets['eur'];
                    // Disable Click
                    gameState.clickPower = 0;
                    createPopup("MOUSE HACKED", "#00ff00", window.innerWidth/2, window.innerHeight/2);
                } else if (universe === 'void') {
                    // Start Entropy
                    createPopup("ENTROPY STARTED", "#ffffff", window.innerWidth/2, window.innerHeight/2);
                } else {
                    // Red Rot
                    createPopup("INFLATION STARTED", "#ff0000", window.innerWidth/2, window.innerHeight/2);
                }

                // Start Loop
                startPhase3Loop();
                updateUI();
            };

            const startPhase3Loop = () => {
                setInterval(() => {
                    // Firewall Healing
                    if(gameState.p3_firewallHealth < 100) {
                        gameState.p3_firewallHealth += 0.5;
                        if(gameState.p3_firewallHealth > 100) gameState.p3_firewallHealth = 100;
                    }

                    // Universe Mechanics
                    if (gameState.p3_universe === 'red_rot') {
                        // Rot Cash 1%
                        gameState.score *= 0.99;
                        // Inflation: Upgrade Costs & Exploit Cost
                        const factor = 1.023;
                        gameState.costPpc = Math.max(gameState.costPpc + 1, Math.floor(gameState.costPpc * factor));
                        gameState.costMulti = Math.max(gameState.costMulti + 1, Math.floor(gameState.costMulti * factor));
                        gameState.costTax = Math.max(gameState.costTax + 1, Math.floor(gameState.costTax * factor));
                        gameState.p3_exploitCost *= 1.005;
                    } else if (gameState.p3_universe === 'matrix') {
                        // High Volatility is handled in volatility loop.
                        // Here we can add passive income buff?
                    } else if (gameState.p3_universe === 'void') {
                        // Entropy: Delete asset randomly
                        if(Math.random() < 0.1) { // 10% chance per second
                            const keys = Object.keys(assets);
                            if(keys.length > 0) {
                                const target = keys[Math.floor(Math.random() * keys.length)];
                                if(assets[target].count > 0) {
                                    assets[target].count = Math.floor(assets[target].count * 0.9); // Lose 10%
                                    createPopup(`ENTROPY: ${assets[target].name} LOST`, "#ffffff", 100, 100);
                                }
                            }
                        }
                    }

                    updateUI();
                }, 1000);
            };

            // Elementler
            const els = {
                score: document.getElementById('score'),
                wealth: document.getElementById('total-wealth'),
                yilongWealth: document.getElementById('realtime-yilong-wealth'),
                yilongWealthDisplaySmall: document.getElementById('yilong-ma-servet-display'),
                wealthProgress: document.getElementById('wealth-progress'),
                dynamicTargetText: document.getElementById('dynamic-target'),
                yilongAvatar: document.getElementById('yilong-avatar'),
                skibidi: document.getElementById('skibidi-toilet'),
                popupCont: document.getElementById('popup-container'),
                floaterCont: document.getElementById('floater-container'),
                msgBox: document.getElementById('message-box'),
                msgContent: document.getElementById('message-content-box'),
                msgText: document.getElementById('message-text'),
                msgClose: document.getElementById('message-close'),

                // ƒ∞statistikler
                statClicks: document.getElementById('stat-clicks'),
                statSlotWin: document.getElementById('stat-slot-win'),
                statTime: document.getElementById('stat-time'),

                // Y√ºkseltme Butonlarƒ± & Textler
                btnPpc: document.getElementById('upgrade-ppc'),
                btnMulti: document.getElementById('upgrade-multi'),
                btnTax: document.getElementById('upgrade-tax'),

                txtLvlPpc: document.getElementById('lvl-ppc'),
                txtCostPpc: document.getElementById('cost-ppc'),
                txtLvlMulti: document.getElementById('lvl-multi'),
                txtCostMulti: document.getElementById('cost-multi'),
                txtLvlTax: document.getElementById('lvl-tax'),
                txtCostTax: document.getElementById('cost-tax'),

                // Slot
                spinBtn: document.getElementById('spin-btn'),
                spinAllInBtn: document.getElementById('spin-all-in-btn'),
                slotCost: document.getElementById('slot-cost'),
                slotCostContainer: document.getElementById('slot-cost-container'),
                slotBetInputContainer: document.getElementById('slot-bet-input-container'),
                slotBetInput: document.getElementById('slot-bet-input'),
                slotStatus: document.getElementById('slot-status'),
                reels: [
                    document.getElementById('reel-inner-1'),
                    document.getElementById('reel-inner-2'),
                    document.getElementById('reel-inner-3')
                ],
                // Mobile Slot
                mSpinBtn: document.getElementById('m-spin-btn'),
                mSpinAllInBtn: document.getElementById('m-spin-all-in-btn'),
                mSlotCost: document.getElementById('m-slot-cost'),
                mSlotStatus: document.getElementById('m-slot-status'),
                mReels: [
                    document.getElementById('m-reel-inner-1'),
                    document.getElementById('m-reel-inner-2'),
                    document.getElementById('m-reel-inner-3')
                ]
            };

            // Varlƒ±klar - Tƒ∞PLERE AYRILDI
            // OPTIMIZATION: Reduced initial history array size from 20 to 10
            let assets = {
                // FIAT (Para Birimleri)
                'tl': { name: "TL", type: "fiat", color: "#f472b6", price: 1.0, count: 0, history: Array(10).fill(1.0) },
                'usd': { name: "USD", type: "fiat", color: "#4ade80", price: 35.0, count: 0, history: Array(10).fill(35.0) },
                'eur': { name: "EUR", type: "fiat", color: "#fb923c", price: 38.0, count: 0, history: Array(10).fill(38.0) },

                // TECH (Teknoloji Hisseleri)
                'nvda': { name: "NVDA", type: "tech", color: "#76b900", price: 130.0, count: 0, history: Array(10).fill(130.0) },
                'googl': { name: "GOOGL", type: "tech", color: "#ea4335", price: 175.0, count: 0, history: Array(10).fill(175.0) },
                'aapl': { name: "AAPL", type: "tech", color: "#a3a3a3", price: 220.0, count: 0, history: Array(10).fill(220.0) },
                'tsla': { name: "TSLA", type: "tech", color: "#e11d48", price: 240.0, count: 0, history: Array(10).fill(240.0) },
                'msft': { name: "MSFT", type: "tech", color: "#0ea5e9", price: 420.0, count: 0, history: Array(10).fill(420.0) },

                // CRYPTO & METALS
                'btc': { name: "BTC", type: "crypto", color: "#ef4444", price: 65000.0, count: 0, history: Array(10).fill(65000.0) },
                'aura': { name: "AURA", type: "crypto", color: "#c084fc", price: 500.0, count: 0, history: Array(10).fill(500.0) },
                'xau': { name: "Altƒ±n", type: "metal", color: "#facc15", price: 2500.0, count: 0, history: Array(10).fill(2500.0) },
            };

            // Ses Motoru
            let synth, sellSynth, slotSynth;
            const initAudio = async () => {
                if (Tone.context.state !== 'running') await Tone.start();
                if (!synth) {
                    // OPTIMIZATION: Limit polyphony to 4 voices
                    synth = new Tone.PolySynth(Tone.Synth, {
                        maxPolyphony: 4,
                        oscillator: { type: "triangle" },
                        envelope: { attack: 0.005, decay: 0.1, sustain: 0, release: 0.1 }
                    }).toDestination();

                    sellSynth = new Tone.MembraneSynth().toDestination();

                    slotSynth = new Tone.Synth({
                        oscillator: { type: "square" },
                        envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.2 }
                    }).toDestination();
                }
            };

            // Formatlama
            const formatNumber = (num) => {
                if (num < 1_000) return Math.floor(num).toString();
                if (num < 1_000_000) return (num / 1_000).toFixed(2) + "K";
                if (num < 1_000_000_000) return (num / 1_000_000).toFixed(2) + "M";
                if (num < 1_000_000_000_000) return (num / 1_000_000_000).toFixed(2) + "B";
                return (num / 1_000_000_000_000).toFixed(2) + "T";
            };

            // Mesaj Kutusu G√∂ster
            const showMessage = (htmlContent) => {
                els.msgText.innerHTML = htmlContent;
                els.msgBox.style.opacity = 1;
                els.msgBox.style.pointerEvents = 'auto';
                els.msgContent.style.transform = 'scale(1)';
            };

            els.msgClose.addEventListener('click', () => {
                els.msgBox.style.opacity = 0;
                els.msgBox.style.pointerEvents = 'none';
                els.msgContent.style.transform = 'scale(0.9)';
            });

            // --- G√ñRSEL EFEKTLER ---
            const createPopup = (text, color = '#fff', x, y) => {
                const popup = document.createElement('div');
                popup.className = 'click-popup text-2xl md:text-4xl';
                popup.textContent = text;
                popup.style.color = color;

                const finalX = x || (Math.random() * 80 + 10) + "%";
                const finalY = y || (Math.random() * 40 + 30) + "%";

                if (typeof x === 'number') {
                    popup.style.left = `${x}px`;
                    popup.style.top = `${y}px`;
                } else {
                    popup.style.left = finalX;
                    popup.style.top = finalY;
                }

                popup.style.setProperty('--rot', `${Math.random() * 40 - 20}deg`);
                els.popupCont.appendChild(popup);
                setTimeout(() => popup.remove(), 800);
            };

            const createParticles = (x, y, count = 3, colorSet = ['#8b5cf6', '#fff']) => {
                for (let i = 0; i < count; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');

                    const size = Math.random() * 8 + 4;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.backgroundColor = colorSet[Math.floor(Math.random() * colorSet.length)];

                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;

                    const angle = Math.random() * Math.PI * 2;
                    const velocity = Math.random() * 100 + 50;

                    particle.style.setProperty('--tx', `${Math.cos(angle) * velocity}px`);
                    particle.style.setProperty('--ty', `${Math.sin(angle) * velocity}px`);

                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 800);
                }
            };

            const createFloater = () => {
                const floaters = ['üóø', 'üíú', 'ü§ì', 'üçë', '‚ú®', 'üî•', 'üëΩ', 'üëª', 'üëë', 'üíØ', 'üí©', 'üí∏', 'üöΩ', 'üß†'];
                const el = document.createElement('div');
                el.className = 'floater';
                el.textContent = floaters[Math.floor(Math.random() * floaters.length)];
                el.style.left = `${Math.random() * 100}vw`;
                el.style.animationDuration = `${Math.random() * 15 + 10}s`;
                els.floaterCont.appendChild(el);
                setTimeout(() => el.remove(), 25000);
            };

            // --- OYUN MANTIƒûI ---

            const handleClick = (e) => {
                initAudio();

                let isCrit = Math.random() < 0.05;
                let gain = gameState.clickPower * gameState.multiplier * gameState.clickDebuff;
                if (isCrit) gain *= 3;

                gameState.score += gain;
                gameState.clicks++;

                if (synth) {
                    const notes = ["C5", "E5", "G5", "B5", "C6"];
                    synth.triggerAttackRelease(notes[Math.floor(Math.random() * notes.length)], "32n");
                }

                const rect = els.skibidi.getBoundingClientRect();
                const x = e ? e.clientX : (rect.left + rect.width / 2);
                const y = e ? e.clientY : (rect.top + rect.height / 2);

                if (isCrit) {
                    createPopup("CRITICAL GYATT!", "#facc15", x, y);
                    createParticles(x, y, 6, ['#facc15', '#f87171']);
                } else {
                    createPopup(`+${formatNumber(gain)}`, "#c084fc", x, y);
                    createParticles(x, y);
                }

                els.skibidi.style.transform = `scale(0.95) rotate(${Math.random() * 10 - 5}deg)`;
                setTimeout(() => els.skibidi.style.transform = 'scale(1) rotate(0deg)', 80);

                updateUI();
            };

            els.skibidi.addEventListener('pointerdown', handleClick);

            // --- Y√úKSELTMELER (LOGIC) ---
            const buyUpgrade = (costKey, lvlKey, type) => {
                if (gameState.score >= gameState[costKey]) {
                    gameState.score -= gameState[costKey];
                    gameState[lvlKey]++;
                    gameState[costKey] = Math.floor(gameState[costKey] * 1.6);

                    if (type === 'ppc') gameState.clickPower += 1;
                    // Auto Clicker Logic Removed
                    if (type === 'multi') gameState.multiplier *= 1.5;
                    if (type === 'tax') gameState.marketPassiveRate += 0.005;

                    if (synth) synth.triggerAttackRelease("C6", "16n");
                    createPopup("LEVEL UP!", "#4ade80", window.innerWidth / 2, window.innerHeight / 2);

                    updateUI();
                }
            };

            els.btnPpc.addEventListener('click', () => buyUpgrade('costPpc', 'lvlPpc', 'ppc'));
            els.btnMulti.addEventListener('click', () => buyUpgrade('costMulti', 'lvlMulti', 'multi'));
            els.btnTax.addEventListener('click', () => buyUpgrade('costTax', 'lvlTax', 'tax'));

            // --- OTO TIKLAYICI REMOVED ---
            setInterval(() => {
                // Removed Auto Clicker Gain Logic

                if (gameState.marketPassiveRate > 0) {
                    let marketValue = 0;
                    for (let key in assets) {
                        marketValue += assets[key].count * assets[key].price;
                    }
                    if (marketValue > 0) {
                        gameState.score += (marketValue * gameState.marketPassiveRate) / 10;
                    }
                }

                updateUI();
            }, 100);

            // --- PHASE 2 TRANSITION LOGIC ---
            const triggerPhase2 = () => {
                gameState.phase = 2;

                // 1. HARD RESET (Assets & Basic Upgrades)
                gameState.score = 10000; // Small fighting chance
                gameState.clicks = 0;
                gameState.clickPower = 10; // Start slightly stronger
                gameState.multiplier = 1;
                gameState.marketPassiveRate = 0;
                gameState.slotWins = 0;

                // Reset Upgrades
                gameState.lvlPpc = 1; gameState.costPpc = 15;
                gameState.lvlMulti = 0; gameState.costMulti = 2500;
                gameState.lvlTax = 0; gameState.costTax = 10000;

                // Reset Assets
                for(let k in assets) {
                    assets[k].count = 0;
                    assets[k].price = assets[k].history[0]; // Reset price roughly to base
                }

                // Apply Black Market Buffs (Permanent Multipliers)
                recalculateMultipliers();

                // 2. YILONG EVOLUTION -> SIGMA STATUE
                YilongBaseWealth = 50000000; // New Base: 50M
                els.yilongAvatar.innerHTML = 'üóø'; // Sigma Statue
                els.yilongAvatar.parentElement.classList.remove('bg-yellow-500/20', 'border-yellow-500/30');
                els.yilongAvatar.parentElement.classList.add('bg-stone-500/20', 'border-stone-500/30');

                // Change UI Colors to reflect Phase 2
                document.body.style.background = "linear-gradient(-45deg, #2a0a10, #450a1f, #1a0505, #000000)";

                // Audio Atmosphere
                if (synth) synth.triggerAttackRelease("A1", "2n");

                // 3. SHOW TRANSITION MESSAGE (DEVLET VERGƒ∞Sƒ∞ / TAX EVENT)
                els.msgContent.className += " border-red-600 shadow-[0_0_50px_red] animate-bounce-short";
                showMessage(`
                    <h2 class="text-5xl font-black text-red-600 mb-6 tracking-tighter animate-pulse">‚ö†Ô∏è DEVLET VERGƒ∞Sƒ∞ ‚ö†Ô∏è</h2>
                    <div class="text-8xl mb-6 animate-bounce">üèõÔ∏è</div>
                    <p class="text-xl text-slate-300 mb-6 italic border-l-4 border-red-500 pl-4 py-2 bg-red-900/20">
                        "Sen kiminle dans ettiƒüini bilmiyorsun..." <br>
                        <span class="text-sm not-italic text-stone-400 mt-2 block">- Sigma Yilong</span>
                    </p>
                    <p class="text-sm text-slate-400 mb-8">
                        Devlet ve Yilong i≈übirliƒüi yaptƒ±. T√ºm varlƒ±klarƒ±na el konuldu.<br>
                        Geriye sadece <strong>10,000 Gyatt</strong> ve <strong>Kara Borsa</strong> eri≈üimi kaldƒ±.
                    </p>
                    <div class="bg-black/50 p-4 rounded-xl border border-red-500/30">
                         <span class="text-red-400 font-mono text-xs">YENƒ∞ HEDEF:</span>
                         <span class="text-2xl font-black text-white block">500.00M</span>
                    </div>
                `);

                // Update UI visibility for Phase 2 elements
                renderBlackMarketUI();

                // Enable Phase 2 Slot Betting
                els.slotCostContainer.classList.add('hidden');
                els.slotBetInputContainer.classList.remove('hidden');
                els.slotBetInputContainer.classList.add('flex');

                updateUI();
            };

            const recalculateMultipliers = () => {
                let bmMult = 1;
                gameState.blackMarketBuffs.forEach(buffId => {
                    const item = blackMarketItems.find(i => i.id === buffId);
                    if(item) bmMult *= item.mult;
                });
                gameState.multiplier *= bmMult;
            };

            const renderBlackMarketUI = () => {
                let bmContainer = document.getElementById('black-market-panel');
                if (!bmContainer) {
                    const upgradesCol = document.getElementById('right-panel');
                    bmContainer = document.createElement('div');
                    bmContainer.id = 'black-market-panel';
                    bmContainer.className = 'glass-panel rounded-3xl p-5 border-t-4 border-red-600 mt-4';
                    bmContainer.innerHTML = `
                        <h2 class="text-xl font-bold mb-4 flex items-center gap-2 text-red-500">
                            <span class="bg-red-500/20 p-2 rounded-lg text-red-500">üè¥‚Äç‚ò†Ô∏è</span>
                            Kara Borsa
                        </h2>
                        <div class="text-xs text-slate-400 mb-3">
                            Kalƒ±cƒ± g√º√ßlendirmeler satƒ±n al. Resetten etkilenmez.
                        </div>
                        <button id="btn-black-market-buy" class="w-full bg-gradient-to-r from-red-900 to-slate-900 hover:from-red-800 hover:to-slate-800 border border-red-500/30 text-white font-bold py-3 rounded-xl shadow-lg relative overflow-hidden group">
                            <span class="relative z-10 flex flex-col items-center">
                                <span>Gƒ∞ZLƒ∞ KASA A√á</span>
                                <span class="text-xs font-mono text-red-300" id="bm-cost-display">100.00K</span>
                            </span>
                            <div class="absolute inset-0 bg-red-500/10 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left"></div>
                        </button>
                        <div id="bm-inventory" class="grid grid-cols-4 gap-2 mt-4"></div>
                    `;
                    upgradesCol.appendChild(bmContainer);
                    document.getElementById('btn-black-market-buy').addEventListener('click', buyBlackMarketItem);
                }
                updateBlackMarketUI();
            };

            const updateBlackMarketUI = () => {
                const btn = document.getElementById('btn-black-market-buy');
                const costDisplay = document.getElementById('bm-cost-display');
                if(!btn) return;

                costDisplay.textContent = formatNumber(gameState.blackMarketCost);

                if(gameState.score < gameState.blackMarketCost) {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'grayscale');
                } else {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'grayscale');
                }

                const inv = document.getElementById('bm-inventory');
                inv.innerHTML = '';
                gameState.blackMarketBuffs.forEach(buffId => {
                    const item = blackMarketItems.find(i => i.id === buffId);
                    if(item) {
                        const el = document.createElement('div');
                        el.className = 'aspect-square rounded-lg bg-slate-800 border flex items-center justify-center text-xl relative group cursor-help';
                        el.style.borderColor = item.color;
                        el.textContent = 'üì¶';
                        el.innerHTML = `
                            <div class="absolute inset-0 flex items-center justify-center text-2xl">üéÅ</div>
                            <div class="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-32 bg-black/90 border border-white/10 p-2 rounded text-[10px] text-center pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity z-50">
                                <strong style="color:${item.color}">${item.name}</strong><br>
                                x${item.mult} Mult
                            </div>
                        `;
                        inv.appendChild(el);
                    }
                });
            };

            const buyBlackMarketItem = () => {
                if(gameState.score >= gameState.blackMarketCost) {
                    gameState.score -= gameState.blackMarketCost;

                    // Update Cost: 10x
                    gameState.blackMarketCost = gameState.blackMarketCost * 10;
                    updateUI();

                    openGachaModal();
                }
            };

            const openGachaModal = () => {
                const modal = document.getElementById('gacha-modal');
                const container = document.getElementById('gacha-cards');

                modal.style.opacity = 1;
                modal.style.pointerEvents = 'auto';
                container.innerHTML = '';

                let hasPicked = false;

                // Create 4 Cards
                for(let i=0; i<4; i++) {
                    const card = document.createElement('div');
                    card.className = "aspect-[3/4] bg-gradient-to-br from-slate-800 to-black border-2 border-red-900/50 rounded-xl cursor-pointer transform hover:scale-105 transition-all duration-300 relative overflow-hidden group shadow-[0_0_30px_rgba(220,38,38,0.2)]";
                    card.innerHTML = `
                        <div class="absolute inset-0 flex items-center justify-center text-6xl opacity-20 group-hover:opacity-100 transition-opacity">‚ùì</div>
                        <div class="absolute inset-0 bg-red-500/10 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                    `;

                    card.addEventListener('click', () => {
                        if(hasPicked) return;
                        hasPicked = true;

                        // Select Item
                        const roll = Math.random();
                        let item;
                        if(roll < 0.05) {
                            // Legendary (0 or 5)
                            item = Math.random() < 0.5 ? blackMarketItems[0] : blackMarketItems[5];
                        }
                        else if(roll < 0.20) {
                            // Epic (1 or 4)
                            item = Math.random() < 0.5 ? blackMarketItems[1] : blackMarketItems[4];
                        }
                        else if(roll < 0.50) item = blackMarketItems[2]; // Rare
                        else item = blackMarketItems[3]; // Common

                        // Reveal Animation for Selected Card
                        card.style.transform = "rotateY(180deg)";
                        card.style.transition = "transform 0.6s";

                        setTimeout(() => {
                            card.style.transform = "rotateY(0deg)";
                            card.className = "aspect-[3/4] bg-slate-900 border-4 rounded-xl flex flex-col items-center justify-center gap-4 shadow-[0_0_50px_currentColor] scale-110 z-50";
                            card.style.borderColor = item.color;
                            card.style.color = item.color;
                            card.innerHTML = `
                                <div class="text-6xl animate-bounce">üéÅ</div>
                                <div class="text-center px-2">
                                    <h3 class="font-bold text-xl leading-tight">${item.name}</h3>
                                    <p class="text-xs text-white mt-2 font-mono">${item.type === 'sabotage' ? 'Yilong -%' + (item.val*100) : 'x' + item.mult + ' Mult'}</p>
                                    <p class="text-[10px] mt-1 opacity-70">${item.rarity}</p>
                                </div>
                            `;

                            if(synth) synth.triggerAttackRelease(["C4", "G4", "C5"], "4n");

                            // Process Reward
                            if (item.type === 'sabotage') {
                                const reduction = YilongBaseWealth * item.val;
                                YilongBaseWealth -= reduction;
                                createPopup(`Yilong: -${formatNumber(reduction)}`, "#ef4444", 90, 10);
                                // Visual Glitch
                                document.body.style.filter = "invert(1)";
                                setTimeout(() => document.body.style.filter = "none", 100);
                            } else {
                                gameState.blackMarketBuffs.push(item.id);
                                recalculateMultipliers();
                            }
                            updateUI();

                            // Close Modal after delay
                            setTimeout(() => {
                                modal.style.opacity = 0;
                                modal.style.pointerEvents = 'none';
                            }, 2500);

                        }, 300);

                        // Fade out other cards
                        Array.from(container.children).forEach(c => {
                            if(c !== card) c.style.opacity = 0.2;
                        });
                    });

                    container.appendChild(card);
                }
            };

            // --- SLOT MAKƒ∞NESƒ∞ ---
            const slotSymbols = ['üçí', 'üçã', 'üçá', 'üíé', '7Ô∏è‚É£', 'üöΩ', '6Ô∏è‚É£', '8Ô∏è‚É£', '9Ô∏è‚É£'];
            const slotWeights = [25, 20, 15, 10, 8, 2, 8, 6, 6];
            const slotWeightsP2 = [20, 15, 12, 10, 12, 5, 10, 8, 8]; // Phase 2 Boosted Odds
            let isSpinning = false;
            let slotCost = 500; // Phase 1 Fixed Cost

            const getRandomSymbol = () => {
                const weights = gameState.phase === 2 ? slotWeightsP2 : slotWeights;
                const rand = Math.random() * 100;
                let sum = 0;
                for (let i = 0; i < weights.length; i++) {
                    sum += weights[i];
                    if (rand <= sum) return slotSymbols[i];
                }
                return slotSymbols[0];
            };

            const spinSlots = async (isMobile = false, overrideBet = -1) => {
                let currentBet = slotCost;

                // Phase 2+: Use custom bet or override
                if (overrideBet > 0) {
                    currentBet = overrideBet;
                } else if (gameState.phase >= 2) {
                    const val = parseInt(els.slotBetInput.value);
                    if (isNaN(val) || val < 100) {
                        els.slotStatus.textContent = "Min Bet: 100";
                        return;
                    }
                    if (val > gameState.score) {
                        els.slotStatus.textContent = "Yetersiz Bakiye";
                        return;
                    }
                    currentBet = val;
                } else {
                    // Phase 1 check
                    if (gameState.score < slotCost) return;
                }

                if (isSpinning) return;
                if (gameState.score < currentBet) return; // Safety check

                // Initialize audio to prevent freeze
                await initAudio();

                gameState.score -= currentBet;
                isSpinning = true;

                const btn = isMobile ? els.mSpinBtn : els.spinBtn;
                const allInBtn = isMobile ? els.mSpinAllInBtn : els.spinAllInBtn;
                const status = isMobile ? els.mSlotStatus : els.slotStatus;
                const currentReels = isMobile ? els.mReels : els.reels;

                btn.disabled = true;
                btn.classList.add('opacity-50');
                if(allInBtn) {
                    allInBtn.disabled = true;
                    allInBtn.classList.add('opacity-50');
                }
                status.textContent = "√áeviriliyor...";
                status.className = "text-yellow-200 animate-pulse";

                let spins = 0;
                const spinInterval = setInterval(() => {
                    currentReels.forEach(reel => {
                        // OPTIMIZATION: Use textContent instead of innerHTML to reduce layout thrashing
                        // We assume the .slot-symbol div already exists inside the reel
                        const symbolDiv = reel.querySelector('.slot-symbol');
                        const randomSymbol = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];

                        if (symbolDiv) {
                            symbolDiv.textContent = randomSymbol;
                        } else {
                            // Fallback if structure is missing
                             reel.innerHTML = `<div class="slot-symbol">${randomSymbol}</div>`;
                        }
                    });

                    if (slotSynth) slotSynth.triggerAttackRelease("C4", "32n");
                    spins++;
                }, 100);

                setTimeout(() => {
                    clearInterval(spinInterval);
                    const results = [getRandomSymbol(), getRandomSymbol(), getRandomSymbol()];

                    currentReels.forEach((reel, i) => {
                        const symbolDiv = reel.querySelector('.slot-symbol');
                        if (symbolDiv) {
                            symbolDiv.textContent = results[i];
                             // Ensure text size is correct for result
                            if(!symbolDiv.classList.contains('text-4xl')) {
                                // Add if needed, though default CSS might handle it.
                                // The original code added text-4xl only on result.
                                symbolDiv.classList.add('text-4xl');
                            }
                        } else {
                             reel.innerHTML = `<div class="slot-symbol text-4xl">${results[i]}</div>`;
                        }
                    });

                    let winMult = 0;
                    let winText = "";
                    let winColor = "text-slate-400";
                    let isSpecialWin = false;

                    const isPhase2 = gameState.phase === 2;

                    // 1. √ñZEL KURAL: 7 - 8 - 9
                    if (results[0] === '7Ô∏è‚É£' && results[1] === '8Ô∏è‚É£' && results[2] === '9Ô∏è‚É£') {
                        winMult = isPhase2 ? 60 : 50;
                        const winAmount = currentBet * winMult;
                        gameState.score += winAmount;
                        gameState.slotWins += winAmount;
                        status.textContent = isPhase2 ? "SIGMA GRINDSET! x60" : "B√úY√úK ƒ∞KRAMƒ∞YE! x50";
                        status.className = "text-fuchsia-400 font-bold jackpot-anim";
                        createPopup(`+${formatNumber(winAmount)}`, "#f0abfc", window.innerWidth / 2, window.innerHeight / 2);
                        if (synth) synth.triggerAttackRelease(["C4", "E4", "G4", "C5", "E5", "G5"], "2n");
                        isSpecialWin = true;
                    }
                    // 2. √ñZEL KURAL: 6 ve 7 Yanyana
                    else if ((results[0] === '6Ô∏è‚É£' && results[1] === '7Ô∏è‚É£') || (results[1] === '6Ô∏è‚É£' && results[2] === '7Ô∏è‚É£')) {
                        winMult = isPhase2 ? 50 : 10;
                        const winAmount = currentBet * winMult;
                        gameState.score += winAmount;
                        gameState.slotWins += winAmount;
                        status.textContent = isPhase2 ? "YAN YANA 6 & 7! x50" : "YAN YANA 6 & 7! x10";
                        status.className = "text-orange-400 font-bold jackpot-anim";
                        createPopup(`+${formatNumber(winAmount)}`, "#fb923c", window.innerWidth / 2, window.innerHeight / 2);
                        if (synth) synth.triggerAttackRelease(["C5", "G5"], "4n");
                        isSpecialWin = true;
                    }
                    // Standart Kurallar
                    else if (results[0] === results[1] && results[1] === results[2]) {
                        const mToilet = isPhase2 ? 1000 : 500;
                        const m7 = isPhase2 ? 200 : 100;
                        const mDiamond = isPhase2 ? 100 : 50;
                        const mBase = isPhase2 ? 40 : 20;

                        if (results[0] === 'üöΩ') winMult = mToilet;
                        else if (results[0] === '7Ô∏è‚É£') winMult = m7;
                        else if (results[0] === 'üíé') winMult = mDiamond;
                        else winMult = mBase;

                        winText = "JACKPOT! üî•";
                        winColor = "text-green-400 font-bold jackpot-anim";
                        if (synth) synth.triggerAttackRelease(["C5", "E5", "G5", "C6"], "4n");
                    } else if (results[0] === results[1] || results[1] === results[2] || results[0] === results[2]) {
                        winMult = isPhase2 ? 5 : 3;
                        winText = "G√ºzel! üëç";
                        winColor = "text-cyan-400 font-bold";
                    } else {
                        winText = "Tekrar dene üíÄ";
                        winColor = "text-slate-400";
                    }

                    if (!isSpecialWin) {
                        status.textContent = winText;
                        status.className = winColor;
                        if (winMult > 0) {
                            const winAmount = currentBet * winMult;
                            gameState.score += winAmount;
                            gameState.slotWins += winAmount;
                            createPopup(`+${formatNumber(winAmount)}`, "#facc15", window.innerWidth / 2, window.innerHeight / 2);
                        }
                    }

                    isSpinning = false;
                    btn.disabled = false;
                    btn.classList.remove('opacity-50');
                    if(allInBtn) {
                        allInBtn.disabled = false;
                        allInBtn.classList.remove('opacity-50');
                    }
                    updateUI();
                }, 2000);
            };

            els.spinBtn.addEventListener('click', () => spinSlots(false));
            els.mSpinBtn.addEventListener('click', () => spinSlots(true));
            if(els.spinAllInBtn) els.spinAllInBtn.addEventListener('click', () => spinSlots(false, gameState.score));
            if(els.mSpinAllInBtn) els.mSpinAllInBtn.addEventListener('click', () => spinSlots(true, gameState.score));


            // --- MARKET Sƒ∞STEMƒ∞ ---
            const marketListContainer = document.getElementById('market-list-container');

            const createMarketItemHTML = (key, asset) => {
                const div = document.createElement('details');
                div.className = "market-box glass-panel rounded-xl border border-white/5 overflow-hidden group transition-all duration-300";
                div.id = `market-${key}-container`;

                div.innerHTML = `
                    <summary class="p-4 cursor-pointer flex items-center justify-between hover:bg-white/5 transition-colors select-none">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center font-bold text-lg shadow-lg" style="color: ${asset.color}; text-shadow: 0 0 10px ${asset.color}40;">
                                ${asset.name.substring(0, 1)}
                            </div>
                            <div class="text-left">
                                <h3 class="font-bold text-slate-200 leading-tight flex items-center gap-2">
                                    ${asset.name}
                                    <span class="text-[9px] px-1.5 py-0.5 rounded ${asset.type === 'tech' ? 'bg-blue-500/20 text-blue-300' : asset.type === 'fiat' ? 'bg-green-500/20 text-green-300' : 'bg-purple-500/20 text-purple-300'} uppercase border border-white/10">${asset.type}</span>
                                </h3>
                                <div class="text-xs text-slate-500">Adet: <span id="count-${key}" class="text-slate-300 font-mono">0</span></div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="text-right">
                                <div id="price-${key}" class="font-mono font-bold text-slate-300 transition-colors duration-500">${asset.price.toFixed(2)}</div>
                            </div>
                            <div class="drag-handle opacity-50 hover:opacity-100 cursor-grab active:cursor-grabbing p-1 hidden md:block">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="19" r="1"></circle></svg>
                            </div>
                        </div>
                    </summary>

                    <div class="p-4 bg-black/20 border-t border-white/5 space-y-4">
                        <div class="h-24 w-full rounded-lg overflow-hidden bg-slate-900/50 relative border border-white/5">
                             <canvas id="chart-${key}"></canvas>
                        </div>
                        <div class="grid grid-cols-4 gap-2">
                            <button class="bg-emerald-600/20 hover:bg-emerald-600/40 text-emerald-400 border border-emerald-500/30 rounded-lg py-2 font-bold text-xs transition-all active:scale-95" data-action="buy" data-asset="${key}">AL</button>
                            <button class="bg-emerald-600/20 hover:bg-emerald-600/40 text-emerald-400 border border-emerald-500/30 rounded-lg py-2 font-bold text-xs transition-all active:scale-95" data-action="buy-all" data-asset="${key}">MAX</button>
                            <button class="bg-rose-600/20 hover:bg-rose-600/40 text-rose-400 border border-rose-500/30 rounded-lg py-2 font-bold text-xs transition-all active:scale-95" data-action="sell" data-asset="${key}">SAT</button>
                            <button class="bg-rose-600/20 hover:bg-rose-600/40 text-rose-400 border border-rose-500/30 rounded-lg py-2 font-bold text-xs transition-all active:scale-95" data-action="sell-all" data-asset="${key}">HEPSƒ∞</button>
                        </div>
                    </div>
                `;

                marketListContainer.appendChild(div);

                const ctx = document.getElementById(`chart-${key}`).getContext('2d');
                const gradient = ctx.createLinearGradient(0, 0, 0, 100);
                gradient.addColorStop(0, `${asset.color}80`);
                gradient.addColorStop(1, 'transparent');

                asset.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: asset.history.map((_, i) => i),
                        datasets: [{
                            data: asset.history,
                            borderColor: asset.color,
                            borderWidth: 2,
                            backgroundColor: gradient,
                            fill: true,
                            pointRadius: 0,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false }, tooltip: { enabled: false } },
                        scales: { x: { display: false }, y: { display: false } },
                        animation: false,
                        elements: {
                            point: {
                                radius: 0 // Disable points for performance
                            }
                        }
                    }
                });
            };

            Object.keys(assets).forEach(key => createMarketItemHTML(key, assets[key]));

            new Sortable(marketListContainer, {
                animation: 200,
                handle: '.drag-handle',
                ghostClass: 'sortable-ghost',
                easing: "cubic-bezier(1, 0, 0, 1)"
            });

            marketListContainer.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (!btn) return;

                const action = btn.dataset.action;
                const key = btn.dataset.asset;
                const asset = assets[key];

                if (!asset) return;

                if (action === 'buy' && gameState.score >= asset.price) {
                    gameState.score -= asset.price;
                    asset.count++;
                } else if (action === 'buy-all') {
                    const max = Math.floor(gameState.score / asset.price);
                    if (max > 0) {
                        gameState.score -= max * asset.price;
                        asset.count += max;
                    }
                } else if (action === 'sell' && asset.count > 0) {
                    gameState.score += asset.price;
                    asset.count--;
                    if (sellSynth) sellSynth.triggerAttackRelease("F2", "32n");
                } else if (action === 'sell-all' && asset.count > 0) {
                    gameState.score += asset.count * asset.price;
                    asset.count = 0;
                    if (sellSynth) sellSynth.triggerAttackRelease("F2", "32n");
                }

                updateUI();
            });

            // --- Fƒ∞YAT DALGALANMASI & VOLATƒ∞Lƒ∞TE ---
            // OPTIMIZATION: Increased interval from 3000ms to 6000ms
            setInterval(() => {
                for (let key in assets) {
                    const asset = assets[key];

                    // VICTORY PUMP (Phase 2 Only)
                    if (gameState.gameWon && asset.count > 0 && gameState.phase !== 3) {
                        asset.price *= 1.25; // +25% every tick (Exponential Growth)
                        createPopup("üöÄ", "#10b981", Math.random() * window.innerWidth, Math.random() * window.innerHeight);
                    } else {
                        // Standard Volatility
                        let volatility = 0.02;
                        if (asset.type === 'crypto') volatility = 0.08;
                        if (asset.type === 'tech') volatility = 0.04;

                        const change = (Math.random() - 0.48) * volatility;
                        asset.price += asset.price * change;
                    }

                    if (asset.price < 0.1) asset.price = 0.1;

                    asset.history.push(asset.price);
                    // OPTIMIZATION: Reduced history length from 20 to 10
                    if (asset.history.length > 10) asset.history.shift();

                    if (asset.chart) {
                        asset.chart.data.datasets[0].data = asset.history;
                        asset.chart.update('none');
                    }

                    const priceEl = document.getElementById(`price-${key}`);
                    if (priceEl) {
                        priceEl.textContent = asset.price.toFixed(2);
                        const prev = asset.history[asset.history.length - 2] || asset.price;
                        priceEl.className = `font-mono font-bold transition-colors duration-500 ${asset.price >= prev ? 'text-emerald-400' : 'text-rose-400'}`;
                    }
                }
            }, 6000);

            // --- UI G√úNCELLEME ---
            window.updateUI = () => {
                els.score.textContent = formatNumber(gameState.score);
                // CPS Logic Removed
                els.statClicks.textContent = formatNumber(gameState.clicks);
                els.statSlotWin.textContent = formatNumber(gameState.slotWins);

                let tw = gameState.score;
                for (let k in assets) {
                    tw += assets[k].count * assets[k].price;
                    document.getElementById(`count-${k}`).textContent = formatNumber(assets[k].count);
                }

                gameState.totalWealth = tw;
                els.wealth.textContent = formatNumber(gameState.totalWealth);

                // --- YILONG vs PLAYER (RIVALRY LOGIC) ---

                if (gameState.phase === 3) {
                    // PHASE 3 FIREWALL UI
                    els.yilongAvatar.innerHTML = 'üî•';
                    const nameLabel = els.yilongAvatar.parentElement.nextElementSibling.querySelector('h3');
                    if(nameLabel) nameLabel.textContent = "THE FIREWALL";

                    els.yilongWealth.textContent = gameState.p3_firewallHealth.toFixed(1) + "% INTEGRITY";
                    els.yilongWealth.style.color = "#ef4444";
                    els.dynamicTargetText.textContent = "DESTROY";

                    els.wealthProgress.style.width = gameState.p3_firewallHealth + "%";
                    els.wealthProgress.parentElement.classList.remove('bg-slate-800');
                    els.wealthProgress.parentElement.classList.add('bg-red-900');

                    // Inject Exploit Button if not exists
                    if(!document.getElementById('p3-exploit-btn')) {
                        const upgrades = document.getElementById('upgrades-list');
                        const btn = document.createElement('button');
                        btn.id = 'p3-exploit-btn';
                        btn.className = "upgrade-btn w-full bg-red-600 hover:bg-red-500 border-2 border-red-400 rounded-xl p-4 font-black text-white animate-pulse mt-4";
                        btn.innerHTML = `LAUNCH EXPLOIT (Attack) <br> <span class='text-[10px] font-mono'>Cost: ${formatNumber(gameState.p3_exploitCost)}</span>`;
                        btn.onclick = () => {
                            const cost = gameState.p3_exploitCost;
                            if(gameState.score >= cost) {
                                gameState.score -= cost;
                                gameState.p3_firewallHealth -= 5; // 5% damage
                                createPopup("HIT! -5%", "#ff0000", window.innerWidth/2, window.innerHeight/2);
                                if(gameState.p3_firewallHealth <= 0) {
                                    // P3 Victory? Or Loop? For now just reset health or trigger 'Simulation Restored'
                                    // "Reset: Ensure that if the player fails... they can Reboot...".
                                    // If wins? "Simulation Collapse" usually implies end.
                                    // I'll make it loop or just stay at 0.
                                    gameState.p3_firewallHealth = 0;
                                    createPopup("SYSTEM CRITICAL", "#ff0000", window.innerWidth/2, window.innerHeight/2);
                                }
                                updateUI();
                            }
                        };
                        upgrades.prepend(btn);
                    }
                } else {
                    // PHASE 1 & 2
                    const currentYilongWealth = YilongBaseWealth;
                    const displayYilong = formatNumber(currentYilongWealth);
                    const targetMult = gameState.phase === 2 ? 10 : 2;
                    const currentTarget = currentYilongWealth * targetMult;
                    const displayTarget = formatNumber(currentTarget);

                    els.yilongWealth.textContent = displayYilong;
                    els.yilongWealthDisplaySmall.textContent = displayYilong;
                    els.dynamicTargetText.textContent = displayTarget;

                    let progress = (gameState.totalWealth / currentTarget) * 100;
                    if (progress < 0) progress = 0;
                    if (progress > 100) progress = 100;
                    els.wealthProgress.style.width = `${progress}%`;

                    // KAZANMA KONTROL√ú (Phase 1 -> Phase 2 Transition)
                    if (gameState.phase === 1 && gameState.totalWealth >= currentTarget) {
                        triggerPhase2();
                    }

                    // NEW: Phase 2 Victory (True Ending)
                    if (gameState.phase === 2 && gameState.totalWealth >= currentTarget && !gameState.gameWon) {
                        gameState.gameWon = true;

                        // 1. Visual Changes
                        els.yilongAvatar.innerHTML = 'üò≠';
                        els.yilongAvatar.parentElement.classList.remove('bg-stone-500/20', 'border-stone-500/30');
                        els.yilongAvatar.parentElement.classList.add('bg-red-500/20', 'border-red-500/30');

                        // Background Change (King Theme)
                        document.body.style.background = "linear-gradient(-45deg, #fcd34d, #059669, #fbbf24, #10b981)";
                        document.body.style.backgroundSize = "400% 400%";

                        // Update Names
                        const nameLabel = els.yilongAvatar.parentElement.nextElementSibling.querySelector('h3');
                        if(nameLabel) nameLabel.textContent = "BROKE YILONG";
                        els.yilongWealthDisplaySmall.previousElementSibling.textContent = "BROKE YILONG";

                        // Player Ascension
                        els.skibidi.textContent = 'üëë';

                        // 2. Market Manipulation (Force Green)
                        for(let k in assets) {
                            assets[k].price *= 5; // Pump it
                        }

                        // 3. Victory Modal
                        showMessage(`
                            <h2 class="text-5xl font-black text-yellow-400 mb-6 tracking-tighter animate-pulse">üëë PIYASANIN YENƒ∞ SAHƒ∞Bƒ∞ SENSƒ∞N! üëë</h2>
                            <p class="text-xl text-slate-300 mb-6">
                                "Yilong Ma diz √ß√∂kt√º. Artƒ±k kurallarƒ± sen koyuyorsun."
                            </p>
                            <div class="text-8xl mb-6 animate-bounce">üóø</div>
                            <p class="text-sm text-slate-400 mb-8">
                                Sonsuz servet ve g√º√ß senin elinde.
                            </p>
                            <button id="victory-continue" class="bg-yellow-500 hover:bg-yellow-400 text-black px-8 py-4 rounded-xl font-black text-xl shadow-[0_0_30px_rgba(234,179,8,0.5)] transition-all transform hover:scale-105">
                                SONSUZ MODDA DEVAM ET
                            </button>
                        `);

                        setTimeout(() => {
                            const btn = document.getElementById('victory-continue');
                            if(btn) btn.addEventListener('click', () => {
                                // Trigger Phase 3 Transition instead of closing
                                triggerPhase3();
                            });
                        }, 100);

                        if (synth) synth.triggerAttackRelease(["C4", "E4", "G4", "C5", "E5", "G5", "C6", "E6"], "1n");
                    }
                }

                // Phase 2 UI Update
                if (gameState.phase === 2) {
                    if (typeof updateBlackMarketUI === 'function') updateBlackMarketUI();
                }

                // Buton Durumlarƒ±
                els.txtLvlPpc.textContent = gameState.lvlPpc;
                els.txtCostPpc.textContent = formatNumber(gameState.costPpc);
                els.btnPpc.disabled = gameState.score < gameState.costPpc;

                // Auto Button Logic Removed

                els.txtLvlMulti.textContent = gameState.lvlMulti;
                els.txtCostMulti.textContent = formatNumber(gameState.costMulti);
                els.btnMulti.disabled = gameState.score < gameState.costMulti;

                els.txtLvlTax.textContent = gameState.lvlTax;
                els.txtCostTax.textContent = formatNumber(gameState.costTax);
                els.btnTax.disabled = gameState.score < gameState.costTax;

                els.slotCost.textContent = formatNumber(slotCost);
                els.mSlotCost.textContent = formatNumber(slotCost);

                // Toggle All In Visibility
                if (gameState.phase >= 2) {
                    if (els.spinAllInBtn) els.spinAllInBtn.classList.remove('hidden');
                    if (els.mSpinAllInBtn) els.mSpinAllInBtn.classList.remove('hidden');
                } else {
                    if (els.spinAllInBtn) els.spinAllInBtn.classList.add('hidden');
                    if (els.mSpinAllInBtn) els.mSpinAllInBtn.classList.add('hidden');
                }

                if (gameState.score < slotCost) {
                    els.spinBtn.disabled = true;
                    els.mSpinBtn.disabled = true;
                    els.spinBtn.classList.add('opacity-50');
                    els.mSpinBtn.classList.add('opacity-50');
                    if(els.spinAllInBtn) els.spinAllInBtn.disabled = true;
                    if(els.mSpinAllInBtn) els.mSpinAllInBtn.disabled = true;
                } else if (!isSpinning) {
                    els.spinBtn.disabled = false;
                    els.mSpinBtn.disabled = false;
                    els.spinBtn.classList.remove('opacity-50');
                    els.mSpinBtn.classList.remove('opacity-50');
                    if(els.spinAllInBtn) {
                        els.spinAllInBtn.disabled = false;
                        els.spinAllInBtn.classList.remove('opacity-50');
                    }
                    if(els.mSpinAllInBtn) {
                        els.mSpinAllInBtn.disabled = false;
                        els.mSpinAllInBtn.classList.remove('opacity-50');
                    }
                }
            };

            const updateUI = window.updateUI;

            setInterval(() => {
                const seconds = Math.floor((Date.now() - gameState.gameStartTime) / 1000);
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                els.statTime.textContent = `${m}:${s}`;

                // Manual CPS Logic Removed
            }, 1000);

            // OPTIMIZATION: Reduced floater generation from 2000ms to 4000ms
            setInterval(createFloater, 4000);

            // --- SKITTER Sƒ∞STEMƒ∞ (MANƒ∞P√úLASYON) ---
            const skitterMessagesEl = document.getElementById('skitter-messages');

            // Tweet Atma Fonksiyonu
            const postSkitt = (msg, author = "Yilong Ma", isNew = false) => {
                const div = document.createElement('div');
                // Eƒüer yeni bir manip√ºlasyon tweeti ise parlama efekti ekle
                const extraClass = isNew ? "new-skitt-glow" : "bg-white/5 border-white/10";

                div.className = `${extraClass} p-3 rounded-xl border mb-2 flex flex-col gap-1 transition-all duration-500`;
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-xs ${author === "Yilong Ma" ? 'text-yellow-400' : 'text-sky-400'}">${author}</span>
                        <span class="text-[8px] text-slate-500">≈ûimdi</span>
                    </div>
                    <p class="text-xs text-slate-300 leading-snug">${msg}</p>
                `;
                skitterMessagesEl.prepend(div);
                if (skitterMessagesEl.children.length > 20) skitterMessagesEl.lastChild.remove();

                // ƒ∞KON ZIPLATMA (Sadece burada √ßaƒüƒ±rƒ±lƒ±yor artƒ±k)
                const skitterFeed = document.getElementById('skitter-feed');
                if (!skitterFeed.open) {
                    const icon = document.getElementById('skitter-icon');
                    // √ñnce varsa sil, sonra tekrar ekle ki animasyon resetlensin
                    icon.classList.remove('animate-bounce');
                    void icon.offsetWidth; // Trigger reflow
                    icon.classList.add('animate-bounce');

                    // 3 saniye sonra zƒ±plamayƒ± durdur
                    setTimeout(() => icon.classList.remove('animate-bounce'), 3000);
                }

                // 5 Saniye sonra mesajƒ±n parlamasƒ±nƒ± kaldƒ±r
                if (isNew) {
                    setTimeout(() => {
                        div.classList.remove("new-skitt-glow");
                        div.classList.add("bg-white/5", "border-white/10");
                    }, 5000);
                }
            };

            // Yilong Ma Piyasayƒ± Manip√ºle Ediyor (Phase 2 Toxic Updates included)
            setInterval(() => {
                if (Math.random() < 0.5) { // %50 ≈üansla tweet
                    const isPhase2 = gameState.phase === 2;
                    let phrase = "";
                    const keys = Object.keys(assets);
                    const targetKey = keys[Math.floor(Math.random() * keys.length)];
                    const target = assets[targetKey];
                    const marketItem = document.getElementById(`market-${targetKey}-container`);

                    if (isPhase2) {
                        // PHASE 2 TOXICITY (100% Rate)
                        const toxic = [
                            "Babanƒ±n ≈üirketini de satƒ±n alacaƒüƒ±m.",
                            "Aƒülama duvarƒ± saƒü tarafta ->",
                            "Tuvalet kaƒüƒ±dƒ± bile alamayacaksƒ±n.",
                            "Fakirler aƒülamasƒ±n.",
                            "Borsa benim oyun alanƒ±m.",
                            "Senin servetin benim bah≈üi≈üim."
                        ];
                        phrase = toxic[Math.floor(Math.random() * toxic.length)];

                        // Phase 2 extra annoying buff
                        if(Math.random() < 0.3) {
                            // Cancel Culture Debuff (30% Chance)
                            if (Math.random() < 0.3) {
                                gameState.clickDebuff = 0.5;
                                phrase = `<span class="text-red-500 font-black">üö´ CANCELED! Tƒ±k g√ºc√ºn %50 d√º≈üt√º!</span>`;
                                createPopup("CANCELED! üìâ", "#ef4444", window.innerWidth/2, window.innerHeight/2);
                                setTimeout(() => { gameState.clickDebuff = 1; }, 10000);
                            }
                        }
                    } else {
                        // STANDARD LOGIC (Phase 1)
                        if (target.type === 'fiat') {
                        phrase = `B√ºt√ºn paramƒ± ${target.name}'ye yatƒ±rdƒ±m. Diƒüer kaƒüƒ±t paralar √ß√∂p! üöÆ`;

                        for (let k in assets) {
                            if (k === targetKey) {
                                assets[k].price *= (1 + (Math.random() * 0.15 + 0.05)); // %5-%20 Artƒ±≈ü
                            } else if (assets[k].type === 'fiat') {
                                assets[k].price *= (1 - (Math.random() * 0.05 + 0.02)); // %2-%7 D√º≈ü√º≈ü (Rakipler)
                            }
                        }
                    }
                    else if (target.type === 'tech') {
                        phrase = `${target.name} geleceƒüi in≈üa ediyor. Yapay zeka, roketler, her ≈üey! üöÄ`;
                        assets[targetKey].price *= 1.10; // %10 net artƒ±≈ü
                    }
                    else {
                        phrase = `${target.name} aya √ßƒ±kƒ±yor! Hold hold hold! üíéüôå`;
                        assets[targetKey].price *= 1.20; // %20 artƒ±≈ü
                    }

                    // YILONG MA KAZANIYOR! (Servetine ekle)
                    let profit = 0;
                    if (isPhase2) {
                        // Phase 2 Scaling: 1% - 4% of Current Wealth
                        profit = YilongBaseWealth * (Math.random() * 0.03 + 0.01);
                    } else {
                        profit = Math.floor(Math.random() * 50000) + 10000;
                    }

                    YilongBaseWealth += profit; // Kendi serveti artƒ±yor
                    createPopup(`Yilong: +${formatNumber(profit)}`, "#facc15", 90, 10); // Saƒü √ºstte popup

                    // VARLIƒûI PARLAT (Piyasa Listesinde)
                    if (marketItem) {
                        marketItem.classList.add('highlight-asset');
                        setTimeout(() => marketItem.classList.remove('highlight-asset'), 3000);
                    }

                    // TWEET AT (isNew = true ile parlamasƒ±nƒ± saƒüla)
                    postSkitt(phrase, "Yilong Ma", true);
                    updateUI();
                }
                } // Close outer if
            }, 12000); // 12 saniyede bir

            postSkitt("5 Milyon dolarƒ±m var. Sizi ge√ßeceƒüim! üòé");
            updateUI();

            // Phase 2 Asset Tax (60 Seconds)
            setInterval(() => {
                if (gameState.phase === 2 && !gameState.gameWon) {
                    const taxAmount = gameState.totalWealth * 0.15;

                    gameState.score -= taxAmount;
                    YilongBaseWealth += taxAmount;

                    showMessage(`
                        <h2 class="text-3xl font-black text-red-600 mb-4 animate-pulse">‚ö†Ô∏è VARLIK VERGƒ∞Sƒ∞</h2>
                        <p class="text-slate-300">Yilong Ma'nƒ±n lobisi sayesinde varlƒ±k vergisi √ßƒ±ktƒ±.</p>
                        <p class="text-red-500 font-bold text-xl mt-4">-${formatNumber(taxAmount)} Gyatt</p>
                        <p class="text-xs text-slate-500 mt-1">Hesabƒ±ndan √ßekildi ve Yilong'a aktarƒ±ldƒ±.</p>
                    `);

                    if (synth) synth.triggerAttackRelease("A1", "8n");
                    updateUI();
                }
            }, 60000);

            // DEV BUTTON LOGIC
            document.getElementById('dev-cheat-btn').addEventListener('click', () => {
                const multiplier = gameState.phase === 2 ? 99 : 1.99;
                const target = YilongBaseWealth * multiplier;
                gameState.score = target;

                createPopup(`DEV: ${multiplier}x CASH SET`, "#ef4444", 100, 50);
                updateUI();
            });
        });

        function toggleMobileSlot() {
            const modal = document.getElementById('mobile-slot-modal');
            modal.classList.toggle('hidden');
        }
    </script>
</body>

</html>