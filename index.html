<!DOCTYPE html>
<!-- Dil baÅŸlangÄ±Ã§ta Ä°ngilizce olacak, JS ile deÄŸiÅŸtirilecek -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- BaÅŸlÄ±k da JS ile ayarlanacak -->
    <title>Skibidi Clicker v2</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js (Sesler iÃ§in) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <!-- Chart.js (Grafikler iÃ§in) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SÃ¼rÃ¼kle-BÄ±rak iÃ§in SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111;
            color: #eee;
            user-select: none;
            overflow-y: auto;
        }

        #skibidi-toilet {
            width: 200px;
            height: 200px;
            font-size: 150px;
            line-height: 200px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.1s ease;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        #skibidi-toilet.clicked {
            transform: scale(0.9);
        }

        #popup-container {
            pointer-events: none;
        }

        .click-popup {
            position: absolute;
            font-size: 2rem;
            font-weight: 900;
            pointer-events: none;
            opacity: 1;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .floater {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            opacity: 0.1;
            animation: float-up 10s linear infinite;
        }

        @keyframes float-up {
            from { transform: translateY(100vh) scale(1); opacity: 0.1; }
            to { transform: translateY(-10vh) scale(1.5); opacity: 0.3; }
        }

        .features-frame {
            background-color: rgba(0, 0, 0, 0.3);
            border: 2px solid #444;
            border-radius: 0.75rem;
            padding: 1.5rem;
            width: 100%;
            max-width: 900px;
            margin: 1.5rem auto;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        .upgrade-btn, .difficulty-btn, .language-btn, .restart-btn { /* Restart butonu eklendi */
            background-color: #333;
            border: 2px solid #555;
            color: #eee;
            padding: 1rem;
            border-radius: 0.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100%;
        }
         /* Dil ve Restart butonu Ã¶zel */
        .language-btn, .restart-btn {
            padding: 0.5rem 1rem;
            font-size: 1.5rem; /* Ä°konlar/Bayraklar iÃ§in */
            height: auto;
        }
        .language-btn.active {
             border-color: #a78bfa; /* Mor vurgu */
             background-color: #444;
        }


        .upgrade-btn:hover:not(:disabled), .difficulty-btn:hover, .language-btn:hover:not(.active), .restart-btn:hover {
            background-color: #444;
            border-color: #777;
            transform: translateY(-2px);
        }

        .upgrade-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        #message-box {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: linear-gradient(145deg, #333, #222); color: #fff;
            padding: 2.5rem; border-radius: 0.75rem; border: 2px solid #555;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6); z-index: 100;
            opacity: 0; pointer-events: none;
            transition: all 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            text-align: center; font-size: 1.5rem; font-weight: 700;
        }
        #message-box.show { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: all; }

        /* Skitter & Dil/Restart DeÄŸiÅŸtirme */
        #top-left-controls {
            position: fixed;
            top: 1rem;
            left: 1rem;
            display: flex;
            align-items: flex-start; /* Ãœstten hizala */
            gap: 0.5rem; /* Aradaki boÅŸluk */
            z-index: 50;
        }
        details#skitter-feed {
            position: relative; /* Normal akÄ±ÅŸta kalsÄ±n */
            width: 300px; max-height: 400px;
            background-color: rgba(10, 10, 20, 0.8); backdrop-filter: blur(5px);
            border: 1px solid #444; border-radius: 0.75rem;
            overflow: hidden; transition: all 0.3s ease;
        }
        details#skitter-feed:not([open]) { width: 80px; height: 80px; max-height: 80px; }
        summary#skitter-header { font-size: 1.25rem; font-weight: 900; color: #38bdf8; padding: 1rem; cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center; }
        details#skitter-feed:not([open]) summary#skitter-header { padding: 0; height: 100%; justify-content: center; flex-direction: column; }
        #skitter-title { display: block; }
        details#skitter-feed:not([open]) #skitter-title,
        details#skitter-feed:not([open]) [data-translate-key="yilongWealthTitle"] { display: none; }
        #yilong-ma-servet-display { font-size: 1.1rem; color: #f59e0b; }
        details#skitter-feed:not([open]) #yilong-ma-servet-display { font-size: 1.25rem; font-weight: 900; }
        summary#skitter-header::-webkit-details-marker { display: none; }
        details#skitter-feed[open] summary#skitter-header { border-bottom: 1px solid #333; }
        #skitter-content { padding: 0 1rem 1rem 1rem; max-height: 300px; display: flex; flex-direction: column; overflow: hidden; }
        details#skitter-feed:not([open]) #skitter-content { display: none; }
        #skitter-messages { overflow-y: auto; display: flex; flex-direction: column-reverse; flex-grow: 1; }
        .skitt { background-color: rgba(255, 255, 255, 0.05); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 0.5rem; animation: fadeIn 0.5s ease; }
        .skitt-author { font-weight: 700; color: #eee; }
        .skitt-author.yilong { color: #f59e0b; }
        .skitt-content { font-size: 0.9rem; color: #ccc; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Pazar Kutusu */
        details.market-box { background-color: rgba(0, 0, 0, 0.2); border-radius: 0.5rem; border: 1px solid #333; transition: background-color 0.2s; }
        details.market-box[open] { background-color: rgba(0, 0, 0, 0.4); }
        summary.market-summary { display: flex; justify-content: space-between; align-items: center; padding: 1rem; cursor: pointer; list-style: none; }
        summary.market-summary::-webkit-details-marker { display: none; }
        .market-content { padding: 0 1rem 1rem 1rem; border-top: 1px solid #333; }
        .price-up { color: #4ade80 !important; text-shadow: 0 0 5px #4ade80; }
        .price-down { color: #f87171 !important; text-shadow: 0 0 5px #f87171; }
        .boosted, .player-boosted { animation: pulse-boost 1s infinite; }
        .notify-glow { animation: notify-glow 1.5s infinite; }
        @keyframes pulse-boost { 0%, 100% { box-shadow: 0 0 15px #f59e0b; } 50% { box-shadow: 0 0 5px #f59e0b; } }
        @keyframes notify-glow { 0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.8); border-color: #f59e0b; } 50% { box-shadow: 0 0 5px rgba(245, 158, 11, 0.3); border-color: #444; } }

        /* SÃ¼rÃ¼kleme */
        .drag-handle { cursor: grab; padding: 0.5rem; margin-left: 0.5rem; opacity: 0.6; transition: opacity 0.2s; }
        .drag-handle:hover { opacity: 1; }
        .drag-handle:active { cursor: grabbing; }
        .sortable-ghost { opacity: 0.4; background: #4a5568; border-radius: 0.5rem; }

        /* Zorluk & Dil SeÃ§imi */
        #difficulty-selection { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(10px); z-index: 200; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2rem; }
        #difficulty-selection h2 { font-size: 3rem; font-weight: 900; color: #c084fc; margin-bottom: 1rem; text-shadow: 0 0 15px #c084fc; }
        #language-selection-initial { margin-bottom: 2rem; display: flex; gap: 1rem; }
        #difficulty-buttons { display: grid; grid-template-columns: repeat(1, 1fr); gap: 1rem; width: 100%; max-width: 400px; }
        @media (min-width: 640px) { #difficulty-buttons { grid-template-columns: repeat(5, 1fr); max-width: 800px; } }
        .difficulty-btn span:first-child { font-size: 1.25rem; }
        .difficulty-btn span:last-child { font-size: 0.8rem; color: #a1a1aa; margin-top: 0.5rem; }

        /* Renkler */
        .text-purple-400 { color: #c084fc; } .text-red-500 { color: #ef4444; } .text-green-400 { color: #4ade80; } .text-orange-400 { color: #fb923c; } .text-pink-400 { color: #f472b6; } .text-yellow-400 { color: #facc15; } .text-slate-300 { color: #cbd5e1; } .text-blue-400 { color: #60a5fa; } .text-slate-100 { color: #f1f5f9; }
        .text-violet-400 { color: #a78bfa; } .text-cyan-400 { color: #22d3ee; } .text-emerald-400 { color: #34d399; } .text-lime-400 { color: #a3e635; } .text-red-400 { color: #f87171; }
    </style>
</head>
<body class="bg-zinc-900 text-zinc-100 min-h-screen p-4 md:p-8 overflow-y-auto">

    <!-- Zorluk ve Dil SeÃ§im EkranÄ± -->
    <div id="difficulty-selection">
        <h2 data-translate-key="difficultyTitle">Zorluk SeÃ§</h2>
        <!-- Dil SeÃ§imi (BaÅŸlangÄ±Ã§) -->
        <div id="language-selection-initial">
             <button class="language-btn active" data-lang="en">ğŸ‡¬ğŸ‡§</button>
             <button class="language-btn" data-lang="tr">ğŸ‡¹ğŸ‡·</button>
        </div>
        <div id="difficulty-buttons">
            <button class="difficulty-btn" data-difficulty="peaceful">
                <span data-translate-key="peaceful">BarÄ±ÅŸÃ§Ä±l</span>
                <span data-translate-key="peacefulDesc">Yilong Ma ile tanÄ±ÅŸ, rekabet yok denecek kadar az.</span>
            </button>
            <button class="difficulty-btn" data-difficulty="easy">
                <span data-translate-key="easy">Kolay</span>
                <span data-translate-key="easyDesc">Ã–ÄŸrenme modu, Yilong Ma Ã§ok hata yapar.</span>
            </button>
            <button class="difficulty-btn" data-difficulty="normal">
                <span data-translate-key="normal">Normal</span>
                <span data-translate-key="normalDesc">Dengeli bir rekabet, standart deneyim.</span>
            </button>
            <button class="difficulty-btn" data-difficulty="hard">
                <span data-translate-key="hard">Zor</span>
                <span data-translate-key="hardDesc">Ciddi meydan okuma, Yilong Ma gÃ¼Ã§lÃ¼.</span>
            </button>
            <button class="difficulty-btn" data-difficulty="hardcore">
                <span data-translate-key="hardcore">Hardcore</span>
                <span data-translate-key="hardcoreDesc">Neredeyse imkansÄ±z, maksimum ceza.</span>
            </button>
        </div>
    </div>

    <!-- Oyun AlanÄ± (BaÅŸlangÄ±Ã§ta Gizli) -->
    <div id="game-area" style="display: none;">

        <!-- Skitter & Dil/Restart DeÄŸiÅŸtirme -->
        <div id="top-left-controls">
            <details id="skitter-feed">
                <summary id="skitter-header">
                    <span id="skitter-title" data-translate-key="skitterTitle">Skitter ğŸ¦</span>
                    <div class="text-center">
                         <span data-translate-key="yilongWealthTitle" class="text-xs text-zinc-400 block">Yilong Ma Serveti</span>
                         <span id="yilong-ma-servet-display">--</span>
                    </div>
                </summary>
                <div id="skitter-content">
                    <div id="skitter-messages">
                        <!-- Skitler JS ile eklenecek, Ã§eviri gerekebilir -->
                    </div>
                </div>
            </details>
            <!-- Dil DeÄŸiÅŸtirme Butonu (Oyun Ä°Ã§i) -->
            <button id="language-toggle" class="language-btn">ğŸ‡¬ğŸ‡§</button>
            <!-- YENÄ°: Yeniden BaÅŸlatma Butonu -->
            <button id="restart-game-btn" class="restart-btn" title="Oyunu Yeniden BaÅŸlat">ğŸ”„</button>
        </div>


        <!-- Ana oyun alanÄ± -->
        <div class="container mx-auto max-w-5xl text-center">

            <h1 class="text-5xl md:text-7xl font-black uppercase" style="text-shadow: 0 0 20px #8b5cf6;">
                skibidi clicker
            </h1>
            <p id="win-condition-display" class="text-lg text-zinc-400 mb-4" data-translate-key="winConditionText" data-translate-multiplier="1.5">Hedef: Yilong Ma'yÄ± 1.5x katlamak!</p>

            <!-- Skor alanÄ± -->
            <div class="score-container bg-zinc-800 p-4 rounded-lg shadow-lg inline-block mb-4">
                <h2 class="text-4xl font-bold">
                    <span id="score" class="text-violet-400">0</span>
                </h2>
                <p class="text-zinc-400" data-translate-key="gyattPoints">Gyatt Points</p>
            </div>

            <div class="cps-container bg-zinc-800 p-3 rounded-lg shadow-lg inline-block mb-4 ml-4">
                <h3 class="text-2xl font-bold">
                    <span id="cps" class="text-cyan-400">0.0</span>
                </h3>
                <p class="text-zinc-400" data-translate-key="cps">CPS</p>
            </div>

            <!-- Toplam Servet GÃ¶stergesi -->
            <div class="cps-container bg-zinc-800 p-3 rounded-lg shadow-lg inline-block mb-4 ml-4">
                <h3 class="text-2xl font-bold">
                    <span id="total-wealth" class="text-emerald-400">0</span>
                </h3>
                <p class="text-zinc-400" data-translate-key="totalWealth">Toplam Servet</p>
            </div>

            <!-- Skibidi -->
            <div class="relative flex justify-center items-center my-8">
                <div id="skibidi-toilet" class="select-none">ğŸš½</div>
                <div id="popup-container" class="absolute inset-0"></div>
            </div>

            <div id="floater-container" class="absolute top-0 left-0 w-full h-full -z-10 overflow-hidden"></div>

            <!-- YÃ¼kseltmeler -->
            <div class="features-frame" id="upgrades-frame">
                <h2 class="text-2xl font-bold text-center mb-4" data-translate-key="upgradesTitle">YÃ¼kseltmeler</h2>
                <div id="upgrades-container" class="grid grid-cols-1 gap-4 w-full max-w-xs mx-auto">
                    <button id="upgrade-ppc" class="upgrade-btn bg-zinc-800 border-zinc-700">
                        <span class="text-xl" data-translate-key="moreRizz">More Rizz (Level <span id="ppc-level">1</span>)</span>
                        <span class="text-sm text-zinc-400" data-translate-key="moreRizzDesc">TÄ±klama baÅŸÄ±na +1 Gyatt</span>
                        <span class="text-lg font-bold mt-2">
                            <span data-translate-key="cost">Bedel</span>: <span id="ppc-cost" class="text-violet-400">10</span>
                        </span>
                    </button>
                </div>
            </div>

            <!-- Piyasalar -->
            <div class="features-frame" id="markets-frame">
                <h2 class="text-2xl font-bold text-center mb-4" data-translate-key="marketsTitle">Piyasalar ğŸ“ˆ</h2>
                <div id="market-list-container" class="space-y-4">
                    <!-- Para birimleri buraya JavaScript ile eklenecek -->
                </div>
            </div>

        </div>

        <!-- Mesaj kutusu -->
        <div id="message-box">
            <p id="message-text"></p>
            <button id="message-close" class="mt-6 bg-violet-600 hover:bg-violet-700 px-6 py-2 rounded-lg font-bold transition-all" data-translate-key="slay">Slay</button>
        </div>
    </div> <!-- Oyun AlanÄ± Sonu -->

    <script>
        // --- DÄ°L VERÄ°SÄ° ---
        const translations = {
            en: {
                // ... (Ã–nceki Ã§eviriler) ...
                 restartGameTitle: "Restart Game", // Yeni
                 // DiÄŸer Ã§eviriler...
                 gameTitle: "Skibidi Clicker v2", difficultyTitle: "Select Difficulty", peaceful: "Peaceful", peacefulDesc: "Meet Yilong Ma, almost no competition.", easy: "Easy", easyDesc: "Learning mode, Yilong Ma makes many mistakes.", normal: "Normal", normalDesc: "Balanced competition, standard experience.", hard: "Hard", hardDesc: "Serious challenge, Yilong Ma is strong.", hardcore: "Hardcore", hardcoreDesc: "Almost impossible, maximum penalty.", winConditionText: "Goal: Beat Yilong Ma by {multiplier}x!", gyattPoints: "Gyatt Points", cps: "CPS", totalWealth: "Total Wealth", upgradesTitle: "Upgrades", moreRizz: "More Rizz (Level {level})", moreRizzDesc: "+1 Gyatt per click", cost: "Cost", marketsTitle: "Markets ğŸ“ˆ", slay: "Slay", skitterTitle: "Skitter ğŸ¦", yilongWealthTitle: "Yilong Ma Wealth", available: "Available", profitLabel: "Profit/Loss", yieldLabel: "Yield (sec)", buyButton: "Buy (1)", sellButton: "Sell (1)", buyAllButton: "Buy All ({amount})", sellAllButton: "Sell All ({amount})", asset_tl: "Turkish Lira (TL)", asset_usd: "Dollar (USD)", asset_eur: "Euro (EUR)", asset_xag: "Silver (XAG)", asset_aura: "AURA", asset_xau: "Gold (XAU)", asset_plt: "Platinum (PLT)", asset_btc: "Bitcoin (BTC)", asset_dia: "Diamond (DIA)", popupRizz: "+1 RIZZ! ğŸ”¥", popupBuy: "{asset}+ ğŸ“ˆ", popupSell: "SOLD! ğŸ’¸", popupBuyAll: "{amount} {asset} BOUGHT ğŸ“ˆ", popupSellAll: "ALL SOLD! ğŸ’¸", popupTax: "-{percent}% TAX! ğŸ’¸", skitterDev: "Skitter Dev", skitterAnalysis: "Skitter Analysis", taxOffice: "Tax Office", yilongMa: "Yilong Ma", skitterWelcome: "Skitter is live! Check out the markets.", yilongBored: "Markets are boring... Need to farm some Gyatt points.", yilongSoldProfit: "Closed my {asset} position just now. Nice profit.", yilongSoldTax: "This {asset} sale hurt, but taxes... ğŸ˜’", yilongSoldForced: "Forced {asset} sale. Tax office is after me.", yilongSoldStopLoss: "Said HODL but {asset} started dropping. Cut my losses.", yilongSoldTakeProfit: "Take-profit time for {asset}.", yilongSoldCash: "Markets risky, converting some to cash. {asset} sold.", yilongSoldBad: "Didn't go as expected, exited {asset} position.", yilongHodl: "Look at the {asset} price... I think it will go higher. Not selling! #HODL",
                yilongBuyMsgKey: ["yilongBuyBase", "yilongBuyAdd", "yilongBuyOpportunity", "yilongBuyDip", "yilongBuyCheap", "yilongBuyQuiet", "yilongBuyFuture", "yilongBuyRizz", "yilongBuyThink", "yilongBuyInteresting"],
                yilongSellMsgKey: ["yilongSoldProfit", "yilongSoldProfit", "yilongSoldTax", "yilongSoldForced", "yilongSoldStopLoss", "yilongSoldTakeProfit", "yilongSoldCash", "yilongSoldBad"],
                skitterPumpMsgKey: ["analysisPump", "analysisOrders", "analysisJump", "analysisVolume", "analysisWhale", "analysisSignal", "analysisFuel", "analysisMomentum", "analysisFomo", "analysisBreakout"],
                yilongBuyBase: "Just bought {amount} {asset}! This is the future. ğŸš€ #tothemoon", yilongBuyAdd: "Added some {asset} to the portfolio. The future is here.", yilongBuyOpportunity: "Saw a good entry point for {asset}.", yilongBuyDip: "Buying {asset} while everyone is selling. ğŸ˜‰", yilongBuyCheap: "This {asset} price is a steal, had to get in.", yilongBuyQuiet: "Quietly accumulating {asset}...", yilongBuyFuture: "Investing in the future: {asset}.", yilongBuyRizz: "Used my rizz to buy {asset}.", yilongBuyThink: "I think {asset} will rise. Position taken.", yilongBuyInteresting: "{asset}... looks interesting. Made a small buy.", analysisPump: "LOOKS LIKE {asset} IS MOVING! Pump might be starting!", analysisOrders: "ANALYSIS: Large buy orders detected for {asset}! ğŸ“ˆ", analysisJump: "Sudden jump in {asset} price! What's happening?", analysisVolume: "Caught on radar: {asset} volume increasing!", analysisWhale: "A big whale might be accumulating {asset}. Watch out!", analysisSignal: "Skitter Signal: STRONG BUY for {asset}.", analysisFuel: "{asset}... Rocket fueling up... ğŸš€", analysisMomentum: "Hot Update: {asset} price gaining momentum!", analysisFomo: "FOMO STARTING? {asset} is trending!", analysisBreakout: "Technical Analysis: Breakout moment for {asset}!",
                taxTime: "TAX TIME! ğŸš¨ A deduction of %{percent} ({amount} Gyatt) has been made from your total wealth.", taxEvasionSuccess: "Yilong Ma managed to evade taxes this time... ğŸ¦…", taxPaymentYilong: "%{percent} ({amount} Gyatt) tax deducted from Yilong Ma's total wealth.", taxLiquidationWarning: "Yilong Ma doesn't have enough cash for taxes! Selling assets for {amount} debt...", taxLiquidationReport: "Yilong Ma was forced to sell {assets} for tax debt.", taxLiquidationFail: "Yilong Ma sold all assets but still has {amount} debt! On the verge of bankruptcy!", winMessage: '<span class="text-5xl">ğŸ† YOU WON! ğŸ†</span><br><br>Your Wealth: <span class="text-emerald-400">{playerWealth}</span><br>Yilong Ma\'s Wealth: <span class="text-red-400">{yilongWealth}</span><br><br>You beat him by {multiplier}x! Ultimate Rizz!'

            },
            tr: {
                // ... (Ã–nceki Ã§eviriler) ...
                restartGameTitle: "Oyunu Yeniden BaÅŸlat", // Yeni
                // DiÄŸer Ã§eviriler...
                 gameTitle: "Skibidi Clicker v2", difficultyTitle: "Zorluk SeÃ§", peaceful: "BarÄ±ÅŸÃ§Ä±l", peacefulDesc: "Yilong Ma ile tanÄ±ÅŸ, rekabet yok denecek kadar az.", easy: "Kolay", easyDesc: "Ã–ÄŸrenme modu, Yilong Ma Ã§ok hata yapar.", normal: "Normal", normalDesc: "Dengeli bir rekabet, standart deneyim.", hard: "Zor", hardDesc: "Ciddi meydan okuma, Yilong Ma gÃ¼Ã§lÃ¼.", hardcore: "Hardcore", hardcoreDesc: "Neredeyse imkansÄ±z, maksimum ceza.", winConditionText: "Hedef: Yilong Ma'yÄ± {multiplier}x katlamak!", gyattPoints: "Gyatt PuanÄ±", cps: "GPS", totalWealth: "Toplam Servet", upgradesTitle: "YÃ¼kseltmeler", moreRizz: "More Rizz (Seviye {level})", moreRizzDesc: "TÄ±klama baÅŸÄ±na +1 Gyatt", cost: "Bedel", marketsTitle: "Piyasalar ğŸ“ˆ", slay: "Slay", skitterTitle: "Skitter ğŸ¦", yilongWealthTitle: "Yilong Ma Serveti", available: "Mevcut", profitLabel: "KÃ¢r/Zarar", yieldLabel: "Getiri (sn)", buyButton: "Al (1)", sellButton: "Sat (1)", buyAllButton: "Hepsini Al ({amount})", sellAllButton: "Hepsini Sat ({amount})", asset_tl: "TÃ¼rk LirasÄ± (TL)", asset_usd: "Dolar (USD)", asset_eur: "Euro (EUR)", asset_xag: "GÃ¼mÃ¼ÅŸ (XAG)", asset_aura: "AURA", asset_xau: "AltÄ±n (XAU)", asset_plt: "Platinyum (PLT)", asset_btc: "Bitcoin (BTC)", asset_dia: "Elmas (DIA)", popupRizz: "+1 RIZZ! ğŸ”¥", popupBuy: "{asset}+ ğŸ“ˆ", popupSell: "SATILDI! ğŸ’¸", popupBuyAll: "{amount} {asset} ALINDI ğŸ“ˆ", popupSellAll: "HEPSÄ° SATILDI! ğŸ’¸", popupTax: "-%{percent} VERGÄ°! ğŸ’¸", skitterDev: "Skitter Dev", skitterAnalysis: "Skitter Analiz", taxOffice: "Vergi Dairesi", yilongMa: "Yilong Ma", skitterWelcome: "Skitter yayÄ±nda! Piyasalara gÃ¶z atÄ±n.", yilongBored: "Piyasalar Ã§ok sÄ±kÄ±cÄ±... Biraz Gyatt puanÄ± biriktirmem lazÄ±m.", yilongSoldProfit: "Az Ã¶nce aldÄ±ÄŸÄ±m {asset} pozisyonunu kapattÄ±m. KÃ¢r gÃ¼zel.", yilongSoldTax: "Bu {asset} satÄ±ÅŸÄ± canÄ±mÄ± sÄ±ktÄ± ama vergi... ğŸ˜’", yilongSoldForced: "Zorunlu {asset} satÄ±ÅŸÄ±. Vergi dairesi peÅŸimde.", yilongSoldStopLoss: "HODL dedim ama {asset} dÃ¼ÅŸmeye baÅŸladÄ±. Zarar kes (Stop-loss) yaptÄ±m.", yilongSoldTakeProfit: "{asset} iÃ§in kar al (Take-profit) zamanÄ±.", yilongSoldCash: "Piyasalar riskli, biraz nakite dÃ¶nÃ¼yorum. {asset} satÄ±ldÄ±.", yilongSoldBad: "BeklediÄŸim gibi gitmedi, {asset} pozisyonundan Ã§Ä±ktÄ±m.", yilongHodl: "{asset} fiyatÄ±na bak... Bence daha da artacak. SatmÄ±yorum! #HODL",
                 yilongBuyMsgKey: ["yilongBuyBase", "yilongBuyAdd", "yilongBuyOpportunity", "yilongBuyDip", "yilongBuyCheap", "yilongBuyQuiet", "yilongBuyFuture", "yilongBuyRizz", "yilongBuyThink", "yilongBuyInteresting"],
                 yilongSellMsgKey: ["yilongSoldProfit", "yilongSoldProfit", "yilongSoldTax", "yilongSoldForced", "yilongSoldStopLoss", "yilongSoldTakeProfit", "yilongSoldCash", "yilongSoldBad"],
                 skitterPumpMsgKey: ["analysisPump", "analysisOrders", "analysisJump", "analysisVolume", "analysisWhale", "analysisSignal", "analysisFuel", "analysisMomentum", "analysisFomo", "analysisBreakout"],
                 yilongBuyBase: "Az Ã¶nce {amount} adet {asset} aldÄ±m! Bu geleceÄŸin parasÄ±. ğŸš€ #tothemoon", yilongBuyAdd: "PortfÃ¶ye biraz {asset} ekledim. Gelecek burada.", yilongBuyOpportunity: "{asset} iÃ§in gÃ¼zel bir alÄ±m fÄ±rsatÄ± gÃ¶rdÃ¼m.", yilongBuyDip: "Herkes satarken ben {asset} topluyorum. ğŸ˜‰", yilongBuyCheap: "Bu {asset} fiyatÄ± bedava, girmemek olmazdÄ±.", yilongBuyQuiet: "Sessizce {asset} biriktiriyorum...", yilongBuyFuture: "GeleceÄŸe yatÄ±rÄ±m: {asset}.", yilongBuyRizz: "Rizz'imi {asset} almak iÃ§in kullandÄ±m.", yilongBuyThink: "Bence {asset} yÃ¼kselecek. Pozisyon alÄ±ndÄ±.", yilongBuyInteresting: "{asset}... ilginÃ§ gÃ¶rÃ¼nÃ¼yor. KÃ¼Ã§Ã¼k bir alÄ±m yaptÄ±m.", analysisPump: "GÃ–RÃœNÃœÅE GÃ–RE {asset} HAREKETLENÄ°YOR! Pump baÅŸlÄ±yor olabilir!", analysisOrders: "ANALÄ°Z: {asset} iÃ§in bÃ¼yÃ¼k alÄ±m emirleri gÃ¶rÃ¼ldÃ¼! ğŸ“ˆ", analysisJump: "{asset} fiyatÄ±nda ani bir sÄ±Ã§rama! Neler oluyor?", analysisVolume: "RadarÄ±mÄ±za yakalandÄ±: {asset} hacmi artÄ±yor!", analysisWhale: "BÃ¼yÃ¼k bir balina {asset} topluyor olabilir. Dikkat!", analysisSignal: "Skitter Sinyali: {asset} iÃ§in GÃœÃ‡LÃœ AL.", analysisFuel: "{asset}... Roket yakÄ±tÄ± dolduruluyor... ğŸš€", analysisMomentum: "SÄ±cak GeliÅŸme: {asset} fiyatÄ± ivme kazanÄ±yor!", analysisFomo: "FOMO BAÅLIYOR MU? {asset} trendlerde!", analysisBreakout: "Teknik Analiz: {asset} iÃ§in kÄ±rÄ±lma (breakout) anÄ±!",
                 taxTime: "VERGÄ° ZAMANI! ğŸš¨ Toplam servetiniz Ã¼zerinden %{percent} oranÄ±nda ({amount} Gyatt) kesinti yapÄ±ldÄ±.", taxEvasionSuccess: "Yilong Ma bu sefer vergiden kaÃ§Ä±nmayÄ± baÅŸardÄ±... ğŸ¦…", taxPaymentYilong: "Yilong Ma'nÄ±n toplam servetinden (%{percent}) {amount} Gyatt vergi kesildi.", taxLiquidationWarning: "Yilong Ma'nÄ±n vergi iÃ§in nakdi yetmedi! VarlÄ±k satÄ±yor ({amount} borÃ§ iÃ§in)...", taxLiquidationReport: "Yilong Ma, vergi borcu iÃ§in zorunlu olarak {assets} sattÄ±.", taxLiquidationFail: "Yilong Ma'nÄ±n tÃ¼m varlÄ±klarÄ± satÄ±ldÄ± ama hala {amount} borcu var! Ä°flasÄ±n eÅŸiÄŸinde!", winMessage: '<span class="text-5xl">ğŸ† KAZANDIN! ğŸ†</span><br><br>Servetin: <span class="text-emerald-400">{playerWealth}</span><br>Yilong Ma\'nÄ±n Serveti: <span class="text-red-400">{yilongWealth}</span><br><br>Onu {multiplier}x katladÄ±n! MuhteÅŸem Rizz!'
            }
        };

        // --- ZORLUK AYARLARI ---
        const difficultySettings = { /* ... (Ã¶nceki koddan kopyalanacak) ... */
             peaceful: { yilongStartWealth: 500_000_000_000, winMultiplier: 1.5, taxEnabled: false, yilongPumpDuration: 10, playerBoostEnabled: true, playerBoostDuration: 5, pltPayoutRate: 0.0005, pltStableDuration: Infinity, pltStartPrice: 20000.00, yilongHodlChance: 0.50, yilongInvestmentAmount: 0.05, yilongPostVisibility: 1.00, yilongPortfolio: ['tl', 'usd', 'eur'], yilongStrategy: 'passive' },
             easy: { yilongStartWealth: 1_000_000_000_000, winMultiplier: 2.0, taxEnabled: true, taxSymmetry: true, playerTaxRange: [0.10, 0.20], yilongTaxRange: [0.10, 0.20], yilongEvasionChance: 0.00, yilongPumpDuration: 10, playerBoostEnabled: false, pltPayoutRate: 0.0001, pltStableDuration: 600, pltStartPrice: 10000.00, yilongHodlChance: 0.40, yilongInvestmentAmount: 0.06, yilongPostVisibility: 0.50, yilongPortfolio: ['tl', 'usd', 'eur', 'xag', 'aura', 'xau', 'plt', 'btc'], yilongStrategy: 'cheap' },
             normal: { yilongStartWealth: 1_000_000_000_000, winMultiplier: 2.0, taxEnabled: true, taxSymmetry: false, playerTaxRange: [0.20, 0.60], yilongTaxRange: [0.20, 0.40], yilongEvasionChance: 0.50, yilongPumpDuration: 10, playerBoostEnabled: false, pltPayoutRate: 0.0001, pltStableDuration: 180, pltStartPrice: 20000.00, yilongHodlChance: 0.25, yilongInvestmentAmount: 0.08, yilongPostVisibility: 0.50, yilongPortfolio: ['aura', 'btc', 'usd', 'eur', 'xau', 'xag', 'dia', 'plt'], yilongStrategy: 'balanced' },
             hard: { yilongStartWealth: 1_000_000_000_000, winMultiplier: 2.0, taxEnabled: true, taxSymmetry: false, playerTaxRange: [0.20, 0.60], yilongTaxRange: [0.10, 0.30], yilongEvasionChance: 0.95, yilongPumpDuration: 5, playerBoostEnabled: false, pltPayoutRate: 0.0001, pltStableDuration: 60, pltStartPrice: 20000.00, yilongHodlChance: 0.10, yilongInvestmentAmount: 0.12, yilongPostVisibility: 0.70, yilongPortfolio: ['aura', 'btc', 'usd', 'eur', 'xau', 'xag', 'dia', 'plt'], yilongStrategy: 'expensive' },
             hardcore: { yilongStartWealth: 1_500_000_000_000, winMultiplier: 3.0, taxEnabled: true, taxSymmetry: false, playerTaxRange: [0.30, 0.70], yilongTaxRange: [0.10, 0.30], yilongEvasionChance: 0.99, yilongPumpDuration: 2.5, playerBoostEnabled: false, pltPayoutRate: 0.00005, pltStableDuration: 0, pltStartPrice: 20000.00, yilongHodlChance: 0.05, yilongInvestmentAmount: 0.15, yilongPostVisibility: 0.95, yilongPortfolio: ['aura', 'btc', 'usd', 'eur', 'xau', 'xag', 'dia', 'plt'], yilongStrategy: 'aggressive_expensive' }
        };

        // --- MEVCUT DURUM ---
        let currentLanguage = 'en';
        let selectedDifficulty = 'normal';
        let currentSettings = difficultySettings.normal;
        let allAssets = null;
        let skitterMessagesEl = null;


        // --- DÄ°L FONKSÄ°YONLARI ---
        function translate(key, replacements = {}) {
            let text = translations[currentLanguage]?.[key] || translations['en']?.[key] || key;
            for (const placeholder in replacements) {
                const regex = new RegExp(`{${placeholder}}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function updateUIText() {
            document.documentElement.lang = currentLanguage;
            document.title = translate('gameTitle');

            document.querySelectorAll('[data-translate-key]').forEach(element => {
                const key = element.dataset.translateKey;
                const replacements = {};
                if (key === 'moreRizz') replacements.level = document.getElementById('ppc-level')?.textContent || '1';
                if (key === 'winConditionText') replacements.multiplier = currentSettings.winMultiplier;
                if ((key.startsWith('buyAllButton') || key.startsWith('sellAllButton')) && allAssets) {
                    const assetKey = element.closest('.market-box')?.id.split('-')[1];
                    if (assetKey && allAssets[assetKey]) {
                         if(key.startsWith('buyAllButton')) replacements.amount = document.getElementById(`${assetKey}-buy-all-amount`)?.textContent || '0';
                         else replacements.amount = document.getElementById(`${assetKey}-sell-all-amount`)?.textContent || '0';
                    } else {
                        replacements.amount = '0';
                    }
                     const amountSpan = element.nextElementSibling; // Parantez iÃ§indeki span
                     const currentText = translate(key, replacements); // Ã–nce Ã§evir
                      // DÃœZELTME: Buton metnini span'e ata, amount'u ayrÄ± elemana
                     if(element.tagName === 'SPAN' && element.parentElement.tagName === 'BUTTON') {
                         // EÄŸer butonun iÃ§indeki ana metin span'Ä± ise
                         element.textContent = currentText.replace(/ *\([^)]*\) */g, ""); // MiktarÄ± sil
                     } else {
                         // DiÄŸer tÃ¼m elementler iÃ§in normal Ã§eviri
                         element.textContent = currentText;
                     }

                } else {
                     element.textContent = translate(key, replacements);
                }
            });

             // Skitter mesajlarÄ±nÄ± yeniden Ã§evir
             if(skitterMessagesEl){
                 skitterMessagesEl.querySelectorAll('.skitt-content[data-translate-key]').forEach(contentEl => {
                    const key = contentEl.dataset.translateKey;
                    let replacements = {};
                    try {
                        replacements = JSON.parse(contentEl.dataset.translateReplacements || '{}');
                    } catch (e) {
                        console.error("Error parsing skitter replacements:", e);
                    }
                    contentEl.innerHTML = translate(key, replacements); // innerHTML kullanÄ±yoruz Ã§Ã¼nkÃ¼ renkli span'ler var
                 });
                  // Skitter yazarlarÄ±nÄ± da Ã§evir (Yilong Ma, Skitter Analysis vb.)
                 skitterMessagesEl.querySelectorAll('.skitt-author').forEach(authorEl => {
                     // Basit bir kontrol, daha saÄŸlam hale getirilebilir
                     if (authorEl.textContent === 'Yilong Ma' || authorEl.textContent === 'Yilong Ma') authorEl.textContent = translate('yilongMa');
                     else if (authorEl.textContent === 'Skitter Analysis' || authorEl.textContent === 'Skitter Analiz') authorEl.textContent = translate('skitterAnalysis');
                     else if (authorEl.textContent === 'Tax Office' || authorEl.textContent === 'Vergi Dairesi') authorEl.textContent = translate('taxOffice');
                     else if (authorEl.textContent === 'Skitter Dev') authorEl.textContent = translate('skitterDev'); // BaÅŸlangÄ±Ã§ mesajÄ± iÃ§in
                 });

             }


             document.querySelectorAll('.language-btn').forEach(btn => {
                 btn.classList.toggle('active', btn.dataset.lang === currentLanguage);
             });
             const langToggle = document.getElementById('language-toggle');
             if(langToggle) langToggle.textContent = currentLanguage === 'tr' ? 'ğŸ‡¹ğŸ‡·' : 'ğŸ‡¬ğŸ‡§';

             // Yeniden baÅŸlat butonunun title'Ä±nÄ± Ã§evir
             const restartBtn = document.getElementById('restart-game-btn');
             if (restartBtn) restartBtn.title = translate('restartGameTitle');
        }


        function setLanguage(lang) {
            if (translations[lang]) {
                currentLanguage = lang;
                localStorage.setItem('skibidiLanguage', lang);
                updateUIText();
            }
        }


        // --- OYUN BAÅLATMA ---
        function startGame(difficulty) {
            selectedDifficulty = difficulty;
            currentSettings = difficultySettings[difficulty];
            document.getElementById('difficulty-selection').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            initializeGame();
            updateUIText(); // ArayÃ¼zÃ¼ oyun baÅŸladÄ±ktan SONRA Ã§evir
        }

        // --- OYUNUN ANA BAÅLATMA MANTIÄI ---
        function initializeGame() {
            const gameStartTime = Date.now();
            const skibidi = document.getElementById('skibidi-toilet');
            const scoreEl = document.getElementById('score');
            const cpsEl = document.getElementById('cps');
            const popupContainer = document.getElementById('popup-container');
            const floaterContainer = document.getElementById('floater-container');
            const totalWealthEl = document.getElementById('total-wealth');
            const upgradePpcBtn = document.getElementById('upgrade-ppc');
            const ppcCostEl = document.getElementById('ppc-cost');
            const ppcLevelEl = document.getElementById('ppc-level');
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');
            const messageCloseBtn = document.getElementById('message-close');
            skitterMessagesEl = document.getElementById('skitter-messages');
            const skitterFeed = document.getElementById('skitter-feed');
            const yilongServetDisplay = document.getElementById('yilong-ma-servet-display');
            const winConditionDisplay = document.getElementById('win-condition-display');
            const marketListContainer = document.getElementById('market-list-container');
            // YENÄ°: Yeniden BaÅŸlatma Butonu Elementi
            const restartBtn = document.getElementById('restart-game-btn');


            let score = 0;
            let pointsPerClick = 1;
            let ppcCost = 10;
            let totalWealth = 0;
            let gameWon = false;
            let clicks = 0;
            let lastCpsCheck = Date.now();
            let synth;
            let sellSynth;
            const popupTexts = {
                 en: ["RIZZ!", "GYATT!", "SO SKIBIDI!", "BUSSIN'", "SIGMA!", "OHIO!", "LOOKSMAXING", "MEWING mew~", "IT'S GIVING...", "SO BASED!", "ATE THAT"],
                 tr: ["RIZZ!", "GYATT!", "Ã‡OK SKIBIDI!", "Ä°ÅTE BU!", "SIGMA!", "OHIO!", "BAKIÅLAR", "MEWING mew~", "HAVASI VAR...", "Ä°ÅTE BU!", "YEDÄ° ONU"]
            };
            const floaters = ['ğŸ—¿', 'ğŸ—ºï¸', 'ğŸ’œ', 'ğŸ¤“', 'ğŸ‘', 'âœ¨', 'ğŸ”¥', 'ğŸ‘½', 'ğŸ‘»', 'ğŸ¤–', 'ğŸ‘‘', 'ğŸ’¯', 'ğŸ§ '];

             allAssets = {
                'tl': { name: "TL", colorClass: "text-pink-400", count: 0, price: 1.00, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(1.00), chart: null, boostTimer: 0, playerBoostTimer: 0 },
                'usd': { name: "USD", colorClass: "text-green-400", count: 0, price: 10.00, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(10.00), chart: null, boostTimer: 0, playerBoostTimer: 0 },
                'eur': { name: "EUR", colorClass: "text-orange-400", count: 0, price: 12.00, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(12.00), chart: null, boostTimer: 0, playerBoostTimer: 0 },
                'xag': { name: "XAG", colorClass: "text-slate-300", count: 0, price: 30.00, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(30.00), chart: null, boostTimer: 0, playerBoostTimer: 0 },
                'aura': { name: "AURA", colorClass: "text-purple-400", count: 0, price: 100.00, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(100.00), chart: null, boostTimer: 0, playerBoostTimer: 0 },
                'xau': { name: "XAU", colorClass: "text-yellow-400", count: 0, price: 2300.00, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(2300.00), chart: null, boostTimer: 0, playerBoostTimer: 0 },
                'plt': { name: "PLT", colorClass: "text-slate-100", count: 0, price: currentSettings.pltStartPrice, payoutRate: currentSettings.pltPayoutRate, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(currentSettings.pltStartPrice), chart: null, boostTimer: 0, playerBoostTimer: 0 },
                'btc': { name: "BTC", colorClass: "text-red-500", count: 0, price: 50000.00, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(50000.00), chart: null, boostTimer: 0, playerBoostTimer: 0 },
                'dia': { name: "DIA", colorClass: "text-blue-400", count: 0, price: 100000.00, totalInvestment: 0, avgBuyPrice: 0, history: Array(30).fill(100000.00), chart: null, boostTimer: 0, playerBoostTimer: 0 },
            };

            // VarlÄ±k GÃ¼ncelleme MantÄ±ÄŸÄ± (updateLogic)
             Object.keys(allAssets).forEach(key => {
                allAssets[key].updateLogic = function() {
                    let volatility, changePercent, baseVolatility; const timeSinceStart = (Date.now() - gameStartTime) / 1000;
                    switch (key) { case 'tl': baseVolatility = 0.03; break; case 'usd': case 'eur': baseVolatility = 0.01; break; case 'xag': case 'btc': baseVolatility = 0.05; break; case 'aura': baseVolatility = 0.1 + (score / 50000000); if (baseVolatility > 0.4) baseVolatility = 0.4; break; case 'xau': baseVolatility = 0.02; break; case 'plt': baseVolatility = 0.08; break; case 'dia': baseVolatility = 0.1; break; default: baseVolatility = 0.05; }
                    if (this.boostTimer > 0) { if (Math.random() < 0.90) { changePercent = (Math.random() * baseVolatility * 1.5) + baseVolatility * 0.5; } else { changePercent = (Math.random() * -baseVolatility * 0.5) - baseVolatility * 0.1; } this.boostTimer--; if (this.boostTimer === 0) { document.getElementById(`market-${key}-container`)?.classList.remove('boosted'); const assetNameKey = `asset_${key}`; const coloredAssetName = `<span class="${this.colorClass} font-bold">${translate(assetNameKey)}</span>`; if (Math.random() > currentSettings.yilongHodlChance) { if (yilongMa.portfolio[key] > 0) { const profit = (this.price - (yilongMa.avgBuyPrices[key] || this.price)) * yilongMa.portfolio[key]; yilongMa.wealth += yilongMa.portfolio[key] * this.price; yilongMa.portfolio[key] = 0; yilongMa.avgBuyPrices[key] = 0; if (Math.random() < currentSettings.yilongPostVisibility) { postSkitt(translate('yilongMa'), null, getRandomMessageKey('yilongSellMsgKey'), {asset: coloredAssetName}); } updateYilongWealthUI(); } } else { if (Math.random() < currentSettings.yilongPostVisibility) { postSkitt(translate('yilongMa'), null, 'yilongHodl', {asset: coloredAssetName}); } } } } else if (this.playerBoostTimer > 0) { changePercent = (Math.random() * baseVolatility * 0.5) + baseVolatility * 0.1; this.playerBoostTimer--; if (this.playerBoostTimer === 0) { document.getElementById(`market-${key}-container`)?.classList.remove('player-boosted'); } } else if (key === 'plt' && timeSinceStart < currentSettings.pltStableDuration) { volatility = 0.005; changePercent = (Math.random() - 0.5) * volatility; } else { volatility = baseVolatility; let trendFactor = 0.5; if (key === 'tl') trendFactor = 0.60; if (key === 'usd' || key === 'eur') trendFactor = 0.48; if (key === 'xau') trendFactor = 0.4; changePercent = (Math.random() - trendFactor) * volatility; } this.price += this.price * changePercent; if (key === 'tl' && this.price < 0.01) this.price = 0.01; else if ((key === 'usd' || key === 'eur' || key === 'xag' || key === 'aura') && this.price < 1) this.price = 1; else if (key === 'dia' && this.price < 1000) this.price = 1000; else if (key === 'plt' && this.price < 10000) this.price = 10000;
                };
            });

            // YILONG MA
            let yilongMa = { wealth: currentSettings.yilongStartWealth, portfolio: { 'aura': 0, 'btc': 0, 'usd': 0, 'eur': 0, 'tl': 0, 'xau': 0, 'xag': 0, 'dia': 0, 'plt': 0 }, avgBuyPrices: { 'aura': 0, 'btc': 0, 'usd': 0, 'eur': 0, 'tl': 0, 'xau': 0, 'xag': 0, 'dia': 0, 'plt': 0 } };
            let yilongMaTotalWealth = currentSettings.yilongStartWealth;
            winConditionDisplay.textContent = translate('winConditionText', { multiplier: currentSettings.winMultiplier });

            // Rastgele Mesaj AnahtarÄ± SeÃ§me
            function getRandomMessageKey(keyArrayName) {
                 const keyArray = translations[currentLanguage]?.[keyArrayName] || translations['en']?.[keyArrayName] || [];
                 if (keyArray.length === 0) return "";
                 return keyArray[Math.floor(Math.random() * keyArray.length)];
            }


            // SES
            const initAudio = async () => { await Tone.start(); console.log("Audio ready"); synth = new Tone.MembraneSynth({ pitchDecay: 0.01, octaves: 2, envelope: { attack: 0.001, decay: 0.2, sustain: 0 } }).toDestination(); sellSynth = new Tone.MetalSynth({ frequency: 200, envelope: { attack: 0.001, decay: 0.1, release: 0.1 }, harmonicity: 5.1, modulationIndex: 32, resonance: 4000, octaves: 1.5 }).toDestination(); }
            const playClickSound = () => { if (!synth) return; synth.triggerAttackRelease("C2", "8n"); }
            const playSellSound = () => { if (!sellSynth) return; sellSynth.triggerAttackRelease("G4", "8n"); }

            // FORMATLAMA
            const formatNumber = (num) => { if (num < 1000) return Math.floor(num).toString(); if (num < 1000000) return (num / 1000).toFixed(2) + "K"; if (num < 1000000000) return (num / 1000000).toFixed(2) + "M"; if (num < 1000000000000) return (num / 1000000000).toFixed(2) + "B"; if (num < 1000000000000000) return (num / 1000000000000).toFixed(2) + "T"; return (num / 1000000000000000).toFixed(2) + "Q"; };

            // UI GÃœNCELLEME
            const updateScoreUI = () => { scoreEl.textContent = formatNumber(score); totalWealth = score; for (const key in allAssets) { totalWealth += allAssets[key].count * allAssets[key].price; } totalWealthEl.textContent = formatNumber(totalWealth); upgradePpcBtn.disabled = score < ppcCost; renderAllMarketsUI(); checkWinCondition(); };
            const updateYilongWealthUI = () => { let portfolioValue = 0; for (const key in yilongMa.portfolio) { if (allAssets[key]) { portfolioValue += yilongMa.portfolio[key] * allAssets[key].price; } } yilongMaTotalWealth = yilongMa.wealth + portfolioValue; yilongServetDisplay.textContent = formatNumber(yilongMaTotalWealth); };
            const renderAllMarketsUI = () => { for (const key in allAssets) { renderMarketUI(key); } };
            const renderMarketUI = (assetKey) => {
                 const asset = allAssets[assetKey]; if (!asset) return;
                 const priceEl = document.getElementById(`${assetKey}-price`);
                 const countEl = document.getElementById(`${assetKey}-count`);
                 const profitLossEl = document.getElementById(`${assetKey}-profit-loss`);
                 const buyAllAmountEl = document.getElementById(`${assetKey}-buy-all-amount`);
                 const sellAllAmountEl = document.getElementById(`${assetKey}-sell-all-amount`);
                 const nameEl = document.querySelector(`#market-${assetKey}-container .market-summary h3`);
                 const availableSpan = document.querySelector(`#market-${assetKey}-container .market-summary span[data-translate-key="available"]`);
                 const profitLabelSpan = document.querySelector(`#market-${assetKey}-container .market-content span[data-translate-key="profitLabel"]`);
                 const yieldLabelSpan = document.querySelector(`#market-${assetKey}-container .market-content span[data-translate-key="yieldLabel"]`);

                 if (!priceEl || !countEl || !profitLossEl || !buyAllAmountEl || !sellAllAmountEl || !nameEl || !availableSpan) { return; }

                 nameEl.textContent = translate(`asset_${assetKey}`);
                 availableSpan.textContent = translate('available');
                 if(profitLabelSpan) profitLabelSpan.textContent = translate('profitLabel');
                 if(yieldLabelSpan && assetKey === 'plt') yieldLabelSpan.textContent = translate('yieldLabel');

                priceEl.textContent = asset.price.toFixed(2);
                countEl.textContent = formatNumber(asset.count);
                if (asset.count > 0) { const profit = asset.price - asset.avgBuyPrice; if (profit >= 0) { profitLossEl.textContent = `+${profit.toFixed(2)}`; profitLossEl.className = 'font-bold text-emerald-400'; } else { profitLossEl.textContent = `${profit.toFixed(2)}`; profitLossEl.className = 'font-bold text-red-400'; } } else { profitLossEl.textContent = '0.00'; profitLossEl.className = 'font-bold text-zinc-400'; }
                const buyAllAmount = Math.floor(score / asset.price); buyAllAmountEl.textContent = formatNumber(buyAllAmount); sellAllAmountEl.textContent = formatNumber(asset.count);
                const buyBtnSpan = document.querySelector(`button[data-asset="${assetKey}"][data-action="buy"] span`); const sellBtnSpan = document.querySelector(`button[data-asset="${assetKey}"][data-action="sell"] span`); const buyAllBtnSpan = document.querySelector(`button[data-asset="${assetKey}"][data-action="buy-all"] span:first-child`); const sellAllBtnSpan = document.querySelector(`button[data-asset="${assetKey}"][data-action="sell-all"] span:first-child`);
                if(buyBtnSpan) buyBtnSpan.textContent = translate('buyButton'); if(sellBtnSpan) sellBtnSpan.textContent = translate('sellButton'); if(buyAllBtnSpan) buyAllBtnSpan.textContent = translate('buyAllButton', {amount: ''}).replace(/ *\([^)]*\) */g, ""); if(sellAllBtnSpan) sellAllBtnSpan.textContent = translate('sellAllButton', {amount: ''}).replace(/ *\([^)]*\) */g, "");
                const buttons = document.querySelectorAll(`button[data-asset="${assetKey}"]`); buttons.forEach(btn => { const action = btn.dataset.action; if (action === 'buy') btn.disabled = score < asset.price; if (action === 'sell') btn.disabled = asset.count === 0; if (action === 'buy-all') btn.disabled = buyAllAmount <= 0; if (action === 'sell-all') btn.disabled = asset.count === 0; }); if (assetKey === 'plt') { const payoutEl = document.getElementById('plt-payout'); if (payoutEl) { if (asset.count > 0) { const payout = (asset.count * asset.price) * asset.payoutRate; payoutEl.textContent = payout.toFixed(2); } else { payoutEl.textContent = '0.00'; } } }
             };

            const createPopup = (text, color = '#fff', xPos = 'random') => { /* ... */ const popup = document.createElement('div'); popup.className = 'click-popup'; popup.textContent = text; popup.style.color = color; let x; if (xPos === 'random') x = Math.random() * 80 + 10; else if (xPos === 'center') x = 40 + Math.random() * 20; else x = xPos; const y = Math.random() * 20 + 30; popup.style.left = `${x}%`; popup.style.top = `${y}%`; popupContainer.appendChild(popup); requestAnimationFrame(() => { popup.style.transform = 'translateY(-100px) scale(1.2)'; popup.style.opacity = '0'; }); setTimeout(() => popup.remove(), 500); };
            const createFloater = () => { /* ... */ const floater = document.createElement('div'); floater.className = 'floater'; floater.textContent = floaters[Math.floor(Math.random() * floaters.length)]; floater.style.left = `${Math.random() * 100}vw`; floater.style.animationDuration = `${Math.random() * 5 + 5}s`; floater.style.fontSize = `${Math.random() * 1 + 1}rem`; floaterContainer.appendChild(floater); setTimeout(() => floater.remove(), 10000); };
            const showMessage = (text) => { /* ... */ messageText.innerHTML = text; messageBox.classList.add('show'); };
            messageCloseBtn.addEventListener('click', () => { /* ... */ messageBox.classList.remove('show'); });
            const checkWinCondition = () => { /* ... */ if (gameWon) return; if (totalWealth > (yilongMaTotalWealth * currentSettings.winMultiplier)) { gameWon = true; showMessage(translate('winMessage', { playerWealth: formatNumber(totalWealth), yilongWealth: formatNumber(yilongMaTotalWealth), multiplier: currentSettings.winMultiplier })); } };

            // SKITTER POST (Ã‡eviri AnahtarÄ± ve Replacements ile)
            const postSkitt = (author, contentOrKey, key = null, replacements = {}) => {
                const skitt = document.createElement('div'); skitt.className = 'skitt';
                const authorEl = document.createElement('span'); authorEl.className = 'skitt-author';
                authorEl.textContent = author;
                if (author === translate('yilongMa')) { authorEl.classList.add('yilong'); }

                const contentEl = document.createElement('p'); contentEl.className = 'skitt-content';
                if (key) {
                    contentEl.dataset.translateKey = key;
                    // DÃœZELTME: Replacements'Ä± JSON string olarak sakla
                    contentEl.dataset.translateReplacements = JSON.stringify(replacements);
                    contentEl.innerHTML = translate(key, replacements);
                } else {
                    contentEl.innerHTML = contentOrKey;
                }

                skitt.appendChild(authorEl); skitt.appendChild(contentEl);
                if(skitterMessagesEl) skitterMessagesEl.prepend(skitt); else console.error("skitterMessagesEl is null!");
                if (!skitterFeed.open) { skitterFeed.classList.add('notify-glow'); }
                if (skitterMessagesEl && skitterMessagesEl.children.length > 20) { skitterMessagesEl.removeChild(skitterMessagesEl.lastChild); }
            };


            // YILONG MA TWEET (postSkitt'e anahtar ve replacements gÃ¶nderir)
            const yilongMaTweet = () => {
                 let possibleAssets = [...currentSettings.yilongPortfolio]; if (currentSettings.yilongStrategy === 'cheap') possibleAssets = possibleAssets.filter(k => ['tl', 'usd', 'eur', 'xag'].includes(k)); else if (currentSettings.yilongStrategy === 'expensive') possibleAssets = possibleAssets.filter(k => ['btc', 'dia', 'plt', 'xau'].includes(k)); else if (currentSettings.yilongStrategy === 'aggressive_expensive') { possibleAssets = possibleAssets.filter(k => ['btc', 'dia'].includes(k)); if (possibleAssets.length === 0 || Math.random() < 0.2) possibleAssets = ['plt', 'xau'];} if (possibleAssets.length === 0) possibleAssets = Object.keys(allAssets).filter(key => currentSettings.yilongPortfolio.includes(key)); if (possibleAssets.length === 0) return; let randomAssetKey = possibleAssets[Math.floor(Math.random() * possibleAssets.length)]; if (randomAssetKey === 'plt' && Math.random() < 0.50) randomAssetKey = possibleAssets[Math.floor(Math.random() * possibleAssets.length)]; if (!randomAssetKey || !allAssets[randomAssetKey]) return; const asset = allAssets[randomAssetKey]; const investmentAmount = yilongMa.wealth * currentSettings.yilongInvestmentAmount; if (investmentAmount < asset.price || yilongMa.wealth <= 0) { if (Math.random() < 0.30) { postSkitt(translate('yilongMa'), null, 'yilongBored'); } return; } const amountToBuy = Math.floor(investmentAmount / asset.price); if (amountToBuy <= 0) return; const currentInvestment = yilongMa.portfolio[randomAssetKey] * (yilongMa.avgBuyPrices[randomAssetKey] || 0); const newInvestment = amountToBuy * asset.price; const totalAmount = yilongMa.portfolio[randomAssetKey] + amountToBuy; yilongMa.avgBuyPrices[randomAssetKey] = (currentInvestment + newInvestment) / totalAmount; yilongMa.wealth -= newInvestment; yilongMa.portfolio[randomAssetKey] += amountToBuy; const assetNameKey = `asset_${randomAssetKey}`; const coloredAssetName = `<span class="${asset.colorClass} font-bold">${translate(assetNameKey)}</span>`; const showTweet = Math.random() < currentSettings.yilongPostVisibility;
                 const replacements = { amount: formatNumber(amountToBuy), asset: coloredAssetName };
                 const msgKey = getRandomMessageKey('yilongBuyMsgKey');
                 if (showTweet) { postSkitt(translate('yilongMa'), null, msgKey, replacements); }
                 updateYilongWealthUI(); const boostDelay = Math.random() * 5000 + 5000; setTimeout(() => { asset.boostTimer = currentSettings.yilongPumpDuration; const container = document.getElementById(`market-${randomAssetKey}-container`); if(container) container.classList.add('boosted');
                 const pumpReplacements = { asset: coloredAssetName };
                 const pumpMsgKey = getRandomMessageKey('skitterPumpMsgKey');
                 if (showTweet) { postSkitt(translate('skitterAnalysis'), null, pumpMsgKey, pumpReplacements); } }, boostDelay);
            };

            const scheduleYilongTweet = () => { /* ... */ const randomDelay = Math.random() * 60000 + 60000; setTimeout(() => { if (!gameWon) { yilongMaTweet(); scheduleYilongTweet(); } }, randomDelay); };
            const initSkitter = () => { /* ... */ scheduleYilongTweet(); };

            // TIKLAMA Ä°ÅLEYÄ°CÄ°LERÄ°
            skibidi.addEventListener('pointerdown', (e) => { /* ... */ if (gameWon) return; if (Tone.context.state !== 'running') { initAudio(); } score += pointsPerClick; clicks++; updateScoreUI(); playClickSound(); skibidi.classList.add('clicked'); setTimeout(() => skibidi.classList.remove('clicked'), 100); const currentPopupTexts = popupTexts[currentLanguage] || popupTexts['en']; const randomText = currentPopupTexts[Math.floor(Math.random() * currentPopupTexts.length)]; const xPos = (e.clientX / window.innerWidth) * 100; createPopup(randomText, '#fff', xPos); });
            document.getElementById('upgrades-frame').addEventListener('click', (e) => { /* ... */ if (gameWon) return; const button = e.target.closest('button'); if (!button) return; if (button.id === 'upgrade-ppc') { if (score >= ppcCost) { score -= ppcCost; pointsPerClick++; ppcCost = Math.floor(ppcCost * 1.5); ppcLevelEl.textContent = pointsPerClick; ppcCostEl.textContent = formatNumber(ppcCost); updateScoreUI(); createPopup(translate('popupRizz'), '#f87171', 'center'); } } });
            document.getElementById('markets-frame').addEventListener('click', (e) => { /* ... */ if (gameWon) return; const button = e.target.closest('button'); if (e.target.closest('.drag-handle')) { return; } if (!button || !button.dataset.asset) return; const assetKey = button.dataset.asset; const action = button.dataset.action; const asset = allAssets[assetKey]; let amountChanged = 0; const assetName = translate(`asset_${assetKey}`); switch(action) { case 'buy': if (score >= asset.price) { const ci=asset.count*asset.avgBuyPrice; const ni=asset.price; const ta=asset.count+1; asset.avgBuyPrice=(ci+ni)/ta; score-=asset.price; asset.count++; amountChanged=1; createPopup(translate('popupBuy', {asset: assetName}), '#4ade80', 'center'); } break; case 'sell': if (asset.count > 0) { score+=asset.price; asset.count--; if(asset.count===0){asset.avgBuyPrice=0;} amountChanged=-1; playSellSound(); createPopup(translate('popupSell'), '#f87171', 'center'); } break; case 'buy-all': const atb=Math.floor(score/asset.price); if(atb>0){ const tc=atb*asset.price; const ci=asset.count*asset.avgBuyPrice; const ni=tc; const ta=asset.count+atb; asset.avgBuyPrice=(ci+ni)/ta; score-=tc; asset.count+=atb; amountChanged=atb; createPopup(translate('popupBuyAll', {amount: formatNumber(atb), asset: assetName}), '#4ade80', 'center'); } break; case 'sell-all': if (asset.count > 0) { const tg=asset.count*asset.price; score+=tg; amountChanged=-asset.count; asset.count=0; asset.avgBuyPrice=0; playSellSound(); createPopup(translate('popupSellAll'), '#f87171', 'center'); } break; } if (amountChanged > 0 && currentSettings.playerBoostEnabled) { asset.playerBoostTimer = currentSettings.playerBoostDuration; const container = document.getElementById(`market-${assetKey}-container`); if(container) container.classList.add('player-boosted'); } renderMarketUI(assetKey); updateScoreUI(); });
             // YENÄ°: Yeniden BaÅŸlatma Butonu Dinleyicisi
             if (restartBtn) {
                 restartBtn.addEventListener('click', () => {
                     window.location.reload(); // SayfayÄ± yenile
                 });
             }

            // OYUN DÃ–NGÃœLERÄ°
            setInterval(createFloater, 500);
            setInterval(() => { /* CPS */ if (gameWon) return; const now = Date.now(); const delta = (now - lastCpsCheck) / 1000; const cpsValue = (clicks / delta).toFixed(1); cpsEl.textContent = cpsValue; clicks = 0; lastCpsCheck = now; }, 1000);
            setInterval(() => { /* Piyasa */ if (gameWon) return; for (const key in allAssets) { const asset = allAssets[key]; const oldPrice = asset.price; asset.updateLogic(); const priceEl = document.getElementById(`${key}-price`); if (priceEl) { priceEl.classList.remove('price-up', 'price-down'); if (asset.price > oldPrice) { priceEl.classList.add('price-up'); } else if (asset.price < oldPrice) { priceEl.classList.add('price-down'); } } asset.history.push(asset.price); if (asset.history.length > 30) { asset.history.shift(); } if (asset.chart) { asset.chart.data.datasets[0].data = asset.history; asset.chart.update('none'); } } updateYilongWealthUI(); renderAllMarketsUI(); checkWinCondition(); }, 4000);
            setInterval(() => { /* PLT Geliri */ if (gameWon) return; const pltAsset = allAssets['plt']; if (pltAsset.count > 0) { const payout = (pltAsset.count * pltAsset.price) * pltAsset.payoutRate; score += payout; updateScoreUI(); } }, 1000);

            // Vergi Ã–deme (Batma Engelli) - Ã‡eviri Eklendi
            const handleYilongTax = (taxAmount) => { /* ... */ if (yilongMa.wealth >= taxAmount) { yilongMa.wealth -= taxAmount; return true; } let debt = taxAmount - yilongMa.wealth; yilongMa.wealth = 0; postSkitt(translate('skitterAnalysis'), null, 'taxLiquidationWarning', {amount: formatNumber(debt)}); let assetsToSell = []; for (const key in yilongMa.portfolio) { if (yilongMa.portfolio[key] > 0 && allAssets[key]) { assetsToSell.push({ key: key, count: yilongMa.portfolio[key], price: allAssets[key].price }); } } assetsToSell.sort((a, b) => b.price - a.price); let soldAssetMessages = []; for (const asset of assetsToSell) { if (debt <= 0) break; const assetValue = asset.count * asset.price; const assetNameKey = `asset_${asset.key}`; const coloredAssetName = `<span class="${allAssets[asset.key].colorClass} font-bold">${translate(assetNameKey)}</span>`; if (assetValue <= debt) { debt -= assetValue; yilongMa.portfolio[asset.key] = 0; yilongMa.avgBuyPrices[asset.key] = 0; soldAssetMessages.push(`${formatNumber(asset.count)} ${coloredAssetName}`); } else { const amountToSell = Math.ceil(debt / asset.price); if (amountToSell >= yilongMa.portfolio[asset.key]) { yilongMa.wealth -= debt; debt = 0; yilongMa.portfolio[asset.key] = 0; yilongMa.avgBuyPrices[asset.key] = 0; soldAssetMessages.push(`${formatNumber(asset.count)} ${coloredAssetName}`); } else { yilongMa.portfolio[asset.key] -= amountToSell; soldAssetMessages.push(`${formatNumber(amountToSell)} ${coloredAssetName}`); debt = 0; } } } if (soldAssetMessages.length > 0) { postSkitt(translate('taxOffice'), null, 'taxLiquidationReport', {assets: soldAssetMessages.join(', ')}); } if (debt > 0) { yilongMa.wealth -= debt; postSkitt(translate('taxOffice'), null, 'taxLiquidationFail', {amount: formatNumber(debt)}); } return true; };

            // Vergi Sistemi BaÅŸlatma (Ã‡eviri ile)
            const startTaxSystem = () => { /* ... */ if (!currentSettings.taxEnabled) return; setInterval(() => { if (gameWon) return; if (Math.random() < 0.15) { const playerTaxRate = Math.random() * (currentSettings.playerTaxRange[1] - currentSettings.playerTaxRange[0]) + currentSettings.playerTaxRange[0]; const playerTaxAmount = Math.floor(totalWealth * playerTaxRate); score = Math.max(0, score - playerTaxAmount); const playerTaxPercent = (playerTaxRate * 100).toFixed(0); postSkitt(translate('taxOffice'), null, 'taxTime', {percent: playerTaxPercent, amount: formatNumber(playerTaxAmount)}); createPopup(translate('popupTax', {percent: playerTaxPercent}), '#f87171', 'center'); let yilongPaysTax = true; if (!currentSettings.taxSymmetry) { if (Math.random() < currentSettings.yilongEvasionChance) { yilongPaysTax = false; postSkitt(translate('skitterAnalysis'), null, 'taxEvasionSuccess'); } } if (yilongPaysTax) { const yilongTaxRate = Math.random() * (currentSettings.yilongTaxRange[1] - currentSettings.yilongTaxRange[0]) + currentSettings.yilongTaxRange[0]; const yilongTaxAmount = Math.floor(yilongMaTotalWealth * yilongTaxRate); const yilongTaxPercent = (yilongTaxRate * 100).toFixed(0); postSkitt(translate('taxOffice'), null, 'taxPaymentYilong', {percent: yilongTaxPercent, amount: formatNumber(yilongTaxAmount)}); handleYilongTax(yilongTaxAmount); } updateScoreUI(); updateYilongWealthUI(); } }, 60000); };


            // HTML Pazar Listesini OluÅŸtur
            marketListContainer.innerHTML = '';
            const sortedKeys = Object.keys(allAssets).sort((a, b) => allAssets[a].price - allAssets[b].price);
            sortedKeys.forEach(key => { /* ... (Ã¶ncekiyle aynÄ±, Ã§eviri kullanÄ±yor) ... */
                 const asset = allAssets[key]; const assetName = translate(`asset_${key}`); const marketBoxHTML = ` <details class="market-box" id="market-${key}-container"> <summary class="market-summary"> <div class="text-left"> <h3 class="text-xl font-bold">${assetName}</h3> <span class="text-sm text-zinc-400"><span data-translate-key="available">Mevcut</span>: <span id="${key}-count" class="font-bold text-emerald-400">0</span></span> </div> <div class="flex items-center"> <div class="text-right"> <span id="${key}-price" class="text-2xl font-bold ${asset.colorClass}">${asset.price.toFixed(2)}</span> </div> <div class="drag-handle text-zinc-500 hover:text-zinc-300" title="TaÅŸÄ±mak iÃ§in sÃ¼rÃ¼kle"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg> </div> </div> </summary> <div class="market-content grid grid-cols-1 md:grid-cols-2 gap-4 items-center"> <div class="flex flex-col gap-3 text-left"> ${key === 'plt' ? `<div class="text-lg bg-zinc-900/50 p-3 rounded-lg"><span data-translate-key="yieldLabel">Getiri (sn)</span>: <span id="plt-payout" class="text-lime-400 font-bold">0.00</span></div>` : ''} <div class="text-lg bg-zinc-900/50 p-3 rounded-lg"> <span data-translate-key="profitLabel">KÃ¢r/Zarar</span>: <span id="${key}-profit-loss" class="font-bold text-zinc-400">0.00</span> </div> </div> <div class="grid grid-cols-2 gap-2"> <button data-asset="${key}" data-action="buy" class="upgrade-btn bg-gradient-to-r from-emerald-500 to-cyan-600 hover:from-emerald-600 hover:to-cyan-700"><span data-translate-key="buyButton">Al (1)</span></button> <button data-asset="${key}" data-action="sell" class="upgrade-btn bg-gradient-to-r from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700"><span data-translate-key="sellButton">Sat (1)</span></button> <button data-asset="${key}" data-action="buy-all" class="upgrade-btn bg-gradient-to-r from-emerald-700 to-cyan-800 hover:from-emerald-800 hover:to-cyan-900"><span data-translate-key="buyAllButton">Hepsini Al</span> (<span id="${key}-buy-all-amount">0</span>)</button> <button data-asset="${key}" data-action="sell-all" class="upgrade-btn bg-gradient-to-r from-red-700 to-orange-800 hover:from-red-800 hover:to-orange-900"><span data-translate-key="sellAllButton">Hepsini Sat</span> (<span id="${key}-sell-all-amount">0</span>)</button> </div> </div> <div class="h-32 p-4 bg-zinc-800/50 rounded-lg"> <canvas id="${key}-chart"></canvas> </div> </details> `; marketListContainer.innerHTML += marketBoxHTML;
             });


            // --- GRAFÄ°K BAÅLATMA ---
            const initChart = (assetKey) => { /* ... */
                 const asset = allAssets[assetKey]; const canvas = document.getElementById(`${assetKey}-chart`); if (!canvas) { console.warn(`Canvas not found: ${assetKey}-chart`); return; } const ctx = canvas.getContext('2d'); const greenGradient = ctx.createLinearGradient(0, 0, 0, 100); greenGradient.addColorStop(0, 'rgba(74, 222, 128, 0.4)'); greenGradient.addColorStop(1, 'rgba(74, 222, 128, 0)'); const redGradient = ctx.createLinearGradient(0, 0, 0, 100); redGradient.addColorStop(0, 'rgba(248, 113, 113, 0.4)'); redGradient.addColorStop(1, 'rgba(248, 113, 113, 0)'); asset.chart = new Chart(ctx, { type: 'line', data: { labels: Array(30).fill(''), datasets: [{ label: `${translate(`asset_${assetKey}`)} Price`, data: asset.history, borderWidth: 2, pointRadius: 0, fill: true, tension: 0.4, segment: { borderColor: ctx => { if (!ctx.p0 || !ctx.p1) return '#4ade80'; if (ctx.p1.parsed.y < ctx.p0.parsed.y) return '#f87171'; return '#4ade80'; }, backgroundColor: ctx => { if (!ctx.p0 || !ctx.p1) return greenGradient; if (ctx.p1.parsed.y < ctx.p0.parsed.y) return redGradient; return greenGradient; } } }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { enabled: false } }, scales: { x: { display: true, grid: { color: 'rgba(255, 255, 255, 0.05)' }, ticks: { display: false } }, y: { display: true, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#999', maxTicksLimit: 5 } } } } });
             };
            Object.keys(allAssets).forEach(key => { try { initChart(key); } catch (e) { console.error(`Chart init failed: ${key}`, e); } });

            // --- OYUNU BAÅLATMA ---
            ppcCostEl.textContent = formatNumber(ppcCost);
            initSkitter();
            startTaxSystem();
            setTimeout(yilongMaTweet, 10000);

            skitterFeed.addEventListener('toggle', () => { if (skitterFeed.open) { skitterFeed.classList.remove('notify-glow'); } });

            // SÃ¼rÃ¼kle-BÄ±rak
            if (marketListContainer) { new Sortable(marketListContainer, { animation: 150, handle: '.drag-handle', ghostClass: 'sortable-ghost' }); }

             updateScoreUI();
             updateYilongWealthUI();


        } // initializeGame sonu

        // --- DÄ°L VE ZORLUK SEÃ‡Ä°MÄ° OLAY DÄ°NLEYÄ°CÄ°LERÄ° ---
        document.querySelectorAll('#language-selection-initial .language-btn').forEach(button => {
            button.addEventListener('click', () => { setLanguage(button.dataset.lang); });
        });
        const langToggleBtn = document.getElementById('language-toggle');
        if(langToggleBtn) { langToggleBtn.addEventListener('click', () => { const newLang = currentLanguage === 'en' ? 'tr' : 'en'; setLanguage(newLang); }); }
        document.querySelectorAll('#difficulty-buttons .difficulty-btn').forEach(button => {
            button.addEventListener('click', () => { const difficulty = button.dataset.difficulty; localStorage.setItem('skibidiDifficulty', difficulty); startGame(difficulty); });
        });
         // YENÄ°: Yeniden BaÅŸlatma Butonu Dinleyicisi (sayfa yÃ¼klendiÄŸinde bir kere eklenir)
         const restartBtnGlobal = document.getElementById('restart-game-btn');
         if (restartBtnGlobal) {
             restartBtnGlobal.addEventListener('click', () => {
                 // KayÄ±tlÄ± zorluk ve dil bilgisini silerek tamamen baÅŸa dÃ¶nmesini saÄŸla (opsiyonel)
                 // localStorage.removeItem('skibidiDifficulty');
                 // localStorage.removeItem('skibidiLanguage');
                 window.location.reload(); // SayfayÄ± yenile
             });
         }


        // --- SAYFA YÃœKLENÄ°NCE ---
        const savedLanguage = localStorage.getItem('skibidiLanguage');
        if (savedLanguage && translations[savedLanguage]) { setLanguage(savedLanguage); }
        else { setLanguage('en'); } // VarsayÄ±lan Ä°ngilizce
        const savedDifficulty = localStorage.getItem('skibidiDifficulty');
        // updateUIText(); // SeÃ§im ekranÄ± iÃ§in ilk Ã§eviriyi yap (setLanguage iÃ§inde zaten yapÄ±lÄ±yor)


    </script>
</body>
</html>

